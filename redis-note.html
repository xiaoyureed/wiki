<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>redis-note - Xiaoyu Wiki</title>
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "light" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="pre.html">pre page</a></li><li class="chapter-item expanded "><a href="SpringBoot-note.html"><strong aria-hidden="true">1.</strong> Spring boot note</a></li><li class="chapter-item expanded "><a href="springcloud-note.html"><strong aria-hidden="true">2.</strong> springcloud-note</a></li><li class="chapter-item expanded "><a href="java-concurrent.html"><strong aria-hidden="true">3.</strong> java-concurrent</a></li><li class="chapter-item expanded "><a href="java-memory-model-jmm-jvm.html"><strong aria-hidden="true">4.</strong> java-memory-model-jmm-jvm</a></li><li class="chapter-item expanded "><a href="java-note.html"><strong aria-hidden="true">5.</strong> java-note</a></li><li class="chapter-item expanded "><a href="rust-note.html"><strong aria-hidden="true">6.</strong> rust-note</a></li><li class="chapter-item expanded "><a href="git-note.html"><strong aria-hidden="true">7.</strong> git note</a></li><li class="chapter-item expanded "><a href="linux-note.html"><strong aria-hidden="true">8.</strong> linux-note</a></li><li class="chapter-item expanded "><a href="cross-gfw.html"><strong aria-hidden="true">9.</strong> cross gfw</a></li><li class="chapter-item expanded "><a href="react-note.html"><strong aria-hidden="true">10.</strong> react-note</a></li><li class="chapter-item expanded "><a href="cs-note.html"><strong aria-hidden="true">11.</strong> cs note</a></li><li class="chapter-item expanded "><a href="distributed-system.html"><strong aria-hidden="true">12.</strong> distributed system</a></li><li class="chapter-item expanded "><a href="message-queue.html"><strong aria-hidden="true">13.</strong> message-queue</a></li><li class="chapter-item expanded "><a href="data-structure-and-algorithm.html"><strong aria-hidden="true">14.</strong> data structure and algorithm</a></li><li class="chapter-item expanded "><a href="effective-java-reading-note.html"><strong aria-hidden="true">15.</strong> effective java reading note</a></li><li class="chapter-item expanded "><a href="docker-note.html"><strong aria-hidden="true">16.</strong> docker note</a></li><li class="chapter-item expanded "><a href="how-to-test-java-app.html"><strong aria-hidden="true">17.</strong> how-to-test-java-app</a></li><li class="chapter-item expanded "><a href="maven-note.html"><strong aria-hidden="true">18.</strong> maven-note</a></li><li class="chapter-item expanded "><a href="mac.html"><strong aria-hidden="true">19.</strong> mac</a></li><li class="chapter-item expanded "><a href="autohotkey.html"><strong aria-hidden="true">20.</strong> AHK collection</a></li><li class="chapter-item expanded "><a href="class-conflict-check.html"><strong aria-hidden="true">21.</strong> class conflict check</a></li><li class="chapter-item expanded "><a href="cpp.html"><strong aria-hidden="true">22.</strong> cpp</a></li><li class="chapter-item expanded "><a href="create-blog-by-react.html"><strong aria-hidden="true">23.</strong> create blog by react</a></li><li class="chapter-item expanded "><a href="css-note.html"><strong aria-hidden="true">24.</strong> css-note</a></li><li class="chapter-item expanded "><a href="css-pre-processor.html"><strong aria-hidden="true">25.</strong> css pre processor</a></li><li class="chapter-item expanded "><a href="defect-about-java-programmer-from-programming-thinking.html"><strong aria-hidden="true">26.</strong> from programming thinking</a></li><li class="chapter-item expanded "><a href="design-pattern-note.html"><strong aria-hidden="true">27.</strong> design pattern note</a></li><li class="chapter-item expanded "><a href="dev-resources.html"><strong aria-hidden="true">28.</strong> dev resources</a></li><li class="chapter-item expanded "><a href="eclipse.html"><strong aria-hidden="true">29.</strong> eclipse</a></li><li class="chapter-item expanded "><a href="extjs-note.html"><strong aria-hidden="true">30.</strong> extjs-note</a></li><li class="chapter-item expanded "><a href="FreeMarker-note.html"><strong aria-hidden="true">31.</strong> FreeMarker-note</a></li><li class="chapter-item expanded "><a href="go-note.html"><strong aria-hidden="true">32.</strong> golang</a></li><li class="chapter-item expanded "><a href="hello-world.html"><strong aria-hidden="true">33.</strong> hexo</a></li><li class="chapter-item expanded "><a href="html-note.html"><strong aria-hidden="true">34.</strong> html-note</a></li><li class="chapter-item expanded "><a href="idea-note.html"><strong aria-hidden="true">35.</strong> idea-note</a></li><li class="chapter-item expanded "><a href="interview-system-design.html"><strong aria-hidden="true">36.</strong> interview-system-design</a></li><li class="chapter-item expanded "><a href="java-code-clean.html"><strong aria-hidden="true">37.</strong> java-code-clean</a></li><li class="chapter-item expanded "><a href="job-interview-cv.html"><strong aria-hidden="true">38.</strong> job-interview-cv</a></li><li class="chapter-item expanded "><a href="joke-collecting.html"><strong aria-hidden="true">39.</strong> joke-collecting</a></li><li class="chapter-item expanded "><a href="jquery-note.html"><strong aria-hidden="true">40.</strong> jquery-note</a></li><li class="chapter-item expanded "><a href="js-tutorial.html"><strong aria-hidden="true">41.</strong> js-tutorial</a></li><li class="chapter-item expanded "><a href="money.html"><strong aria-hidden="true">42.</strong> money</a></li><li class="chapter-item expanded "><a href="mongodb-note.html"><strong aria-hidden="true">43.</strong> mongodb-note</a></li><li class="chapter-item expanded "><a href="mvc-mvvm.html"><strong aria-hidden="true">44.</strong> mvc-mvvm</a></li><li class="chapter-item expanded "><a href="my-ioc.html"><strong aria-hidden="true">45.</strong> my-ioc</a></li><li class="chapter-item expanded "><a href="mybatis-note.html"><strong aria-hidden="true">46.</strong> mybatis-note</a></li><li class="chapter-item expanded "><a href="mysql-note.html"><strong aria-hidden="true">47.</strong> mysql-note</a></li><li class="chapter-item expanded "><a href="nodejs.html"><strong aria-hidden="true">48.</strong> nodejs</a></li><li class="chapter-item expanded "><a href="outline-about-cache.html"><strong aria-hidden="true">49.</strong> outline-about-cache</a></li><li class="chapter-item expanded "><a href="outline-about-db-design-note.html"><strong aria-hidden="true">50.</strong> outline-about-db-design-note</a></li><li class="chapter-item expanded "><a href="outline-about-http.html"><strong aria-hidden="true">51.</strong> outline-about-http</a></li><li class="chapter-item expanded "><a href="outline-about-rest-api.html"><strong aria-hidden="true">52.</strong> outline-about-rest-api</a></li><li class="chapter-item expanded "><a href="php-note.html"><strong aria-hidden="true">53.</strong> php-note</a></li><li class="chapter-item expanded "><a href="postgres-note.html"><strong aria-hidden="true">54.</strong> postgres-note</a></li><li class="chapter-item expanded "><a href="python-note.html"><strong aria-hidden="true">55.</strong> python-note</a></li><li class="chapter-item expanded "><a href="redis-login-limitation.html"><strong aria-hidden="true">56.</strong> redis-login-limitation</a></li><li class="chapter-item expanded "><a href="redis-note.html" class="active"><strong aria-hidden="true">57.</strong> redis-note</a></li><li class="chapter-item expanded "><a href="regex-js.html"><strong aria-hidden="true">58.</strong> regex-js</a></li><li class="chapter-item expanded "><a href="servlet.html"><strong aria-hidden="true">59.</strong> servlet</a></li><li class="chapter-item expanded "><a href="spring-note.html"><strong aria-hidden="true">60.</strong> spring-note</a></li><li class="chapter-item expanded "><a href="springboot-doc.html"><strong aria-hidden="true">61.</strong> springboot-doc</a></li><li class="chapter-item expanded "><a href="springmvc-note.html"><strong aria-hidden="true">62.</strong> springmvc-note</a></li><li class="chapter-item expanded "><a href="task-schedule-note.html"><strong aria-hidden="true">63.</strong> task-schedule-note</a></li><li class="chapter-item expanded "><a href="tcp-ip-note.html"><strong aria-hidden="true">64.</strong> tcp-ip-note</a></li><li class="chapter-item expanded "><a href="tomcat-jetty-nginx.html"><strong aria-hidden="true">65.</strong> tomcat-jetty-nginx</a></li><li class="chapter-item expanded "><a href="webpack-note.html"><strong aria-hidden="true">66.</strong> webpack-note</a></li><li class="chapter-item expanded "><a href="windows-sub-system-on-linux.html"><strong aria-hidden="true">67.</strong> windows-sub-system-on-linux</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Xiaoyu Wiki</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <hr />
<p>title: Redis
tags:</p>
<ul>
<li>redis</li>
<li>nosql
date: 2016-04-28 15:30:56
categories: java web</li>
</ul>
<hr />
<div align="center">
redis ä½¿ç”¨ç¬”è®°; {% post_link ç¼“å­˜æ¦‚è¿° ğŸ“š ç¼“å­˜æ¦‚è¿° %};
reference: [redisåŸºç¡€](https://juejin.im/post/5ad6e4066fb9a028d82c4b66), [redisé›†ç¾¤åŸç†åŠæ­å»ºä¸ä½¿ç”¨](https://juejin.im/post/5ad54d76f265da23970759d3)
ã€Šrediså¼€å‘å’Œè¿ç»´ã€‹
</div>
<!--more-->
<!-- TOC -->
<ul>
<li><a href="#redis%E4%BB%8B%E7%BB%8D">redisä»‹ç»</a>
<ul>
<li><a href="#redis-%E7%89%B9%E6%80%A7">redis ç‰¹æ€§</a></li>
<li><a href="#install">install</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF">ä½¿ç”¨åœºæ™¯</a></li>
</ul>
</li>
<li><a href="#redis%E5%91%BD%E4%BB%A4">rediså‘½ä»¤</a>
<ul>
<li><a href="#%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86%E5%91%BD%E4%BB%A4">ç³»ç»Ÿç®¡ç†å‘½ä»¤</a></li>
<li><a href="#%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C%E5%91%BD%E4%BB%A4">æ•°æ®æ“ä½œå‘½ä»¤</a></li>
<li><a href="#%E9%94%AE%E7%AE%A1%E7%90%86">é”®ç®¡ç†</a></li>
</ul>
</li>
<li><a href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B">æ•°æ®ç±»å‹</a>
<ul>
<li><a href="#streaming-%E7%B1%BB%E5%9E%8B">streaming ç±»å‹</a></li>
<li><a href="#string-%E5%AD%97%E7%AC%A6%E4%B8%B2">String-å­—ç¬¦ä¸²</a></li>
<li><a href="#list-%E5%88%97%E8%A1%A8">List-åˆ—è¡¨</a></li>
<li><a href="#set-%E9%9B%86%E5%90%88">Set-é›†åˆ</a></li>
<li><a href="#hash-%E5%93%88%E5%B8%8C">Hash-å“ˆå¸Œ</a></li>
<li><a href="#zset-%E6%9C%89%E5%BA%8F%E9%9B%86%E5%90%88">ZSet-æœ‰åºé›†åˆ</a></li>
</ul>
</li>
<li><a href="#lua%E8%84%9A%E6%9C%AC">luaè„šæœ¬</a></li>
<li><a href="#%E5%8D%95%E7%BA%BF%E7%A8%8B%E6%9E%B6%E6%9E%84">å•çº¿ç¨‹æ¶æ„</a></li>
<li><a href="#%E5%86%85%E5%AD%98%E6%B7%98%E6%B1%B0%E6%9C%BA%E5%88%B6">å†…å­˜æ·˜æ±°æœºåˆ¶</a>
<ul>
<li><a href="#%E4%B8%89%E9%81%93%E4%BF%9D%E9%99%A9%E4%BF%9D%E8%AF%81-key-%E8%BF%87%E6%9C%9F%E5%A4%84%E7%90%86">ä¸‰é“ä¿é™©ä¿è¯ key è¿‡æœŸå¤„ç†</a></li>
<li><a href="#%E6%9C%89%E5%93%AA%E4%BA%9B%E6%B7%98%E6%B1%B0%E6%9C%BA%E5%88%B6">æœ‰å“ªäº›æ·˜æ±°æœºåˆ¶</a></li>
<li><a href="#%E5%86%85%E5%AD%98%E5%9B%9E%E6%94%B6%E7%AE%97%E6%B3%95">å†…å­˜å›æ”¶ç®—æ³•</a></li>
<li><a href="#%E5%A6%82%E4%BD%95%E9%85%8D%E7%BD%AE%E6%B7%98%E6%B1%B0%E7%AD%96%E7%95%A5">å¦‚ä½•é…ç½®æ·˜æ±°ç­–ç•¥</a>
<ul>
<li><a href="#%E9%80%9A%E8%BF%87%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">é€šè¿‡é…ç½®æ–‡ä»¶</a></li>
<li><a href="#%E9%80%9A%E8%BF%87%E5%91%BD%E4%BB%A4%E8%BF%90%E8%A1%8C%E6%97%B6%E4%BF%AE%E6%94%B9">é€šè¿‡å‘½ä»¤è¿è¡Œæ—¶ä¿®æ”¹</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E6%8C%81%E4%B9%85%E5%8C%96">æŒä¹…åŒ–</a>
<ul>
<li><a href="#%E5%A4%87%E4%BB%BD%E9%80%89%E5%9E%8B">å¤‡ä»½é€‰å‹</a></li>
<li><a href="#rdb-%E5%BF%AB%E7%85%A7%E6%8C%81%E4%B9%85%E5%8C%96">RDB-å¿«ç…§æŒä¹…åŒ–</a>
<ul>
<li><a href="#rdb%E6%8C%81%E4%B9%85%E5%8C%96%E6%A6%82%E5%BF%B5">RDBæŒä¹…åŒ–æ¦‚å¿µ</a></li>
<li><a href="#%E8%A7%A6%E5%8F%91%E6%9C%BA%E5%88%B6-%E5%A6%82%E4%BD%95%E5%BC%80%E5%90%AF">è§¦å‘æœºåˆ¶-å¦‚ä½•å¼€å¯</a></li>
<li><a href="#rdb%E6%96%87%E4%BB%B6">RDBæ–‡ä»¶</a></li>
</ul>
</li>
<li><a href="#aof-%E6%97%A5%E5%BF%97%E6%8C%81%E4%B9%85%E5%8C%96">AOF-æ—¥å¿—æŒä¹…åŒ–</a>
<ul>
<li><a href="#aof%E6%A6%82%E5%BF%B5">aofæ¦‚å¿µ</a></li>
<li><a href="#%E5%86%99%E5%85%A5%E5%8E%9F%E7%90%86">å†™å…¥åŸç†</a></li>
<li><a href="#%E6%96%87%E4%BB%B6%E5%90%8C%E6%AD%A5">æ–‡ä»¶åŒæ­¥</a></li>
<li><a href="#%E9%87%8D%E5%86%99%E6%9C%BA%E5%88%B6">é‡å†™æœºåˆ¶</a></li>
<li><a href="#aof-%E6%8D%9F%E5%9D%8F">aof æŸå</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E5%8F%91%E5%B8%83%E4%B8%8E%E8%AE%A2%E9%98%85">å‘å¸ƒä¸è®¢é˜…</a></li>
<li><a href="#%E4%BA%8B%E5%8A%A1">äº‹åŠ¡</a></li>
<li><a href="#%E4%BA%8B%E4%BB%B6">äº‹ä»¶</a>
<ul>
<li><a href="#%E6%96%87%E4%BB%B6%E4%BA%8B%E4%BB%B6">æ–‡ä»¶äº‹ä»¶</a></li>
<li><a href="#%E6%97%B6%E9%97%B4%E4%BA%8B%E4%BB%B6">æ—¶é—´äº‹ä»¶</a></li>
<li><a href="#%E4%BA%8B%E4%BB%B6%E7%9A%84%E8%B0%83%E5%BA%A6%E6%89%A7%E8%A1%8C">äº‹ä»¶çš„è°ƒåº¦&amp;æ‰§è¡Œ</a></li>
</ul>
</li>
<li><a href="#redis%E9%9B%86%E7%BE%A4">redisé›†ç¾¤</a>
<ul>
<li><a href="#%E8%BF%9E%E6%8E%A5%E8%BF%87%E7%A8%8B">è¿æ¥è¿‡ç¨‹</a></li>
<li><a href="#%E4%B8%BB%E4%BB%8E%E9%93%BE">ä¸»ä»é“¾</a></li>
</ul>
</li>
<li><a href="#%E5%93%A8%E5%85%B5-sentinel">å“¨å…µ Sentinel</a></li>
<li><a href="#%E5%88%86%E7%89%87">åˆ†ç‰‡</a></li>
<li><a href="#%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E8%AE%BA%E5%9D%9B%E7%B3%BB%E7%BB%9F">ä¸€ä¸ªç®€å•çš„è®ºå›ç³»ç»Ÿ</a>
<ul>
<li><a href="#%E6%96%87%E7%AB%A0%E4%BF%A1%E6%81%AF">æ–‡ç« ä¿¡æ¯</a></li>
<li><a href="#%E7%82%B9%E8%B5%9E%E5%8A%9F%E8%83%BD">ç‚¹èµåŠŸèƒ½</a></li>
<li><a href="#%E5%AF%B9%E6%96%87%E7%AB%A0%E8%BF%9B%E8%A1%8C%E6%8E%92%E5%BA%8F">å¯¹æ–‡ç« è¿›è¡Œæ’åº</a></li>
</ul>
</li>
<li><a href="#%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C">ä¸€è‡´æ€§å“ˆå¸Œ</a></li>
<li><a href="#%E6%95%B4%E5%90%88-spring-boot2">æ•´åˆ spring boot2</a>
<ul>
<li><a href="#jedis">jedis</a></li>
<li><a href="#lettuce">lettuce</a></li>
<li><a href="#%E5%AE%9A%E4%B9%89%E5%BA%8F%E5%88%97%E5%8C%96%E5%99%A8">å®šä¹‰åºåˆ—åŒ–å™¨</a></li>
</ul>
</li>
<li><a href="#%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98">é¢è¯•é—®é¢˜</a></li>
<li><a href="#%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81">åˆ†å¸ƒå¼é”</a>
<ul>
<li><a href="#%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86">å®ç°åŸç†</a>
<ul>
<li><a href="#%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E9%9C%80%E8%A6%81%E6%BB%A1%E8%B6%B3%E7%9A%84%E8%A6%81%E6%B1%82">åˆ†å¸ƒå¼é”éœ€è¦æ»¡è¶³çš„è¦æ±‚</a></li>
<li><a href="#%E5%8A%A0%E9%94%81%E6%9C%BA%E5%88%B6">åŠ é”æœºåˆ¶</a></li>
<li><a href="#watch-dog-%E8%87%AA%E5%8A%A8%E5%BB%B6%E6%97%B6%E6%9C%BA%E5%88%B6">watch dog è‡ªåŠ¨å»¶æ—¶æœºåˆ¶</a></li>
<li><a href="#redisson-%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E5%8F%AF%E9%87%8D%E5%85%A5%E9%94%81">redisson å¦‚ä½•å®ç°å¯é‡å…¥é”</a></li>
</ul>
</li>
<li><a href="#redis-%E5%AE%9E%E7%8E%B0-%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81">redis å®ç° åˆ†å¸ƒå¼é”</a></li>
<li><a href="#redisson-%E5%AE%9E%E7%8E%B0">redisson å®ç°</a></li>
</ul>
</li>
</ul>
<!-- /TOC -->
<h1><a class="header" href="#redisä»‹ç»" id="redisä»‹ç»">redisä»‹ç»</a></h1>
<h2><a class="header" href="#redis-ç‰¹æ€§" id="redis-ç‰¹æ€§">redis ç‰¹æ€§</a></h2>
<p>å…¨ç§°: remote dictionary server</p>
<ul>
<li>
<p>é€Ÿåº¦å¿«</p>
<ul>
<li>å› ä¸ºæ˜¯åœ¨å†…å­˜ä¸­è¿è¡Œ</li>
<li>c å®ç°</li>
<li>å•çº¿ç¨‹æ¶æ„, æ²¡æœ‰èµ„æºç«äº‰. - å­˜å‚¨çš„é”®å¾ˆå¤šçš„redis, ä¸è¦æ‰§è¡Œ <code>keys*</code> æ“ä½œ</li>
</ul>
</li>
<li>
<p>åŸºæœ¬æ•°æ®ç»“æ„æ˜¯é”®å€¼å¯¹, ä½†æ˜¯ å€¼å¯ä»¥æ”¯æŒå¤šç§æ•°æ®ç±»å‹</p>
<ul>
<li>string, åœ¨ string åŸºç¡€ä¸Šæ¼”å˜å‡º bitmaps(ä½å›¾), HyperLogLog</li>
<li>hash</li>
<li>é›†åˆ</li>
<li>æœ‰åºé›†åˆ</li>
<li>åˆ—è¡¨</li>
</ul>
</li>
<li>
<p>æä¾›å¤šç§åŠŸèƒ½</p>
<ul>
<li>é”®å¯ä»¥è®¾ç½®è¿‡æœŸæ—¶é—´ - å¯ä»¥ç”¨æ¥å®ç°ç¼“å­˜</li>
<li>å‘å¸ƒè®¢é˜…åŠŸèƒ½ - å¯ä»¥å®ç°æ¶ˆæ¯é˜Ÿåˆ—</li>
<li>æ”¯æŒ lua è„šæœ¬ - å¯ä»¥åˆ©ç”¨ lua åˆ›å»ºæ–°çš„ redis å‘½ä»¤</li>
<li>ç®€å•çš„äº‹åŠ¡æ”¯æŒ</li>
<li>æä¾›äº† pipeline (æµæ°´çº¿) åŠŸèƒ½ - è¿™æ ·å®¢æˆ·ç«¯èƒ½å¤Ÿå°†ä¸€æ‰¹å‘½ä»¤ä¸€æ¬¡æ€§ä¼ åˆ° redis, å‡å°‘äº†ç½‘ç»œå¼€é”€</li>
</ul>
</li>
<li>
<p>æŒä¹…åŒ–æ”¯æŒ</p>
<ul>
<li>
<p>RDB</p>
</li>
<li>
<p>AOF</p>
</li>
</ul>
</li>
<li>
<p>ä¸»ä»å¤åˆ¶ - æ˜¯åˆ†å¸ƒå¼ redis çš„åŸºç¡€</p>
</li>
<li>
<p>é«˜å¯ç”¨andåˆ†å¸ƒå¼</p>
</li>
</ul>
<h2><a class="header" href="#install" id="install">install</a></h2>
<p>Windows</p>
<p>cmdå¯åŠ¨serverç«¯: <code>redis-server.exe redis.windows.conf </code>, redis.windows.confä¸æ˜¯å¿…é¡», å¦‚æœçœç•¥åˆ™ä½¿ç”¨é»˜è®¤é…ç½®</p>
<p>cmdå¯åŠ¨clientç«¯: <code>redis-cli.exe -h 127.0.0.1 -p 6379 </code>, ç„¶åå³å¯åœ¨è¿™ä¸ªç«¯å£è¿›è¡Œåç»­æ“ä½œ.</p>
<p>ubuntuä¸‹å¸è½½</p>
<p>rm -rf var/lib/redis/</p>
<p>rm -rf /var/log/redis</p>
<p>rm -rf /etc/redis/</p>
<p>rm -rf /usr/bin/redis-*</p>
<pre><code class="language-sh">apt-get remove redis # åˆ é™¤
apt-get remove --purge redis # åŒæ—¶åˆ é™¤é…ç½®æ–‡ä»¶
find / -name redis # æ‰¾åˆ°æ®‹ä½™æ–‡ä»¶ åˆ é™¤ä¹‹


</code></pre>
<p>Ubuntuä¸‹å®‰è£…</p>
<pre><code class="language-sh">$sudo apt-get update
$sudo apt-get install redis-server

$ redis-server # å¯åŠ¨server

$ redis-cli # å¯åŠ¨client(redis 127.0.0.1:6379)

# æ£€æµ‹redis serveræ˜¯å¦å¯åŠ¨
127.0.0.1:6379&gt; ping
PONG
</code></pre>
<p>é€šè¿‡æºç å®‰è£…</p>
<pre><code class="language-sh">wget http://download.redis.io/releases/redis-5.0.2.tar.gz # ä¸‹è½½ redis 
tar -zxv -f xxx.tar.gz # è§£å‹
ln -s redis-x.x.x &lt;link_name&gt; # å»ºç«‹å¿«æ·è½¯é“¾æ¥ # æœ€ä½³å®è·µï¼Œ åˆ©äºæœªæ¥ç‰ˆæœ¬å‡çº§
cd redis
make # ç¼–è¯‘
make install # å®‰è£… # å®‰è£…åˆ°äº† /usr/local/bin, è¿™æ ·å°±å¯ä»¥åœ¨ä»»ä½•ç›®å½•ä¸‹ä½¿ç”¨redis å‘½ä»¤äº†

</code></pre>
<h2><a class="header" href="#ä½¿ç”¨åœºæ™¯" id="ä½¿ç”¨åœºæ™¯">ä½¿ç”¨åœºæ™¯</a></h2>
<ul>
<li>
<p>è®¡æ•°å™¨</p>
<ul>
<li>
<p>å¯ä»¥å¯¹ String è¿›è¡Œè‡ªå¢è‡ªå‡è¿ç®—ï¼Œä»è€Œå®ç°è®¡æ•°å™¨åŠŸèƒ½</p>
</li>
<li>
<p>ä¾‹å¦‚å¯¹äºç½‘ç«™è®¿é—®é‡ï¼Œå¦‚æœä½¿ç”¨ MySQL æ•°æ®åº“è¿›è¡Œå­˜å‚¨ï¼Œé‚£ä¹ˆæ¯è®¿é—®ä¸€æ¬¡ç½‘ç«™å°±è¦å¯¹ç£ç›˜è¿›è¡Œè¯»å†™æ“ä½œã€‚è€Œå¯¹ Redis è¿™ç§å†…å­˜å‹æ•°æ®åº“çš„è¯»å†™æ€§èƒ½éå¸¸é«˜ï¼Œå¾ˆé€‚åˆå­˜å‚¨è¿™ç§é¢‘ç¹è¯»å†™çš„è®¡æ•°é‡ã€‚</p>
</li>
</ul>
</li>
<li>
<p>ç¼“å­˜</p>
<p>å°†çƒ­ç‚¹æ•°æ®æ”¾åˆ°å†…å­˜ä¸­ï¼Œè®¾ç½®å†…å­˜çš„æœ€å¤§ä½¿ç”¨é‡ä»¥åŠæ·˜æ±°ç­–ç•¥æ¥ä¿è¯ç¼“å­˜çš„å‘½ä¸­ç‡ã€‚</p>
</li>
<li>
<p>åˆ†å¸ƒå¼ session</p>
<p>åœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹å…·æœ‰å¤šä¸ªåº”ç”¨æœåŠ¡å™¨ï¼Œå¯ä»¥ä½¿ç”¨ Redis æ¥ç»Ÿä¸€å­˜å‚¨è¿™äº›åº”ç”¨æœåŠ¡å™¨çš„ä¼šè¯ä¿¡æ¯ï¼Œä½¿å¾—æŸä¸ªåº”ç”¨æœåŠ¡å™¨å®•æœºæ—¶ä¸ä¼šä¸¢å¤±ä¼šè¯ä¿¡æ¯ï¼Œä»è€Œä¿è¯é«˜å¯ç”¨ã€‚</p>
</li>
<li>
<p>åˆ†å¸ƒå¼é”å®ç°:  SETNX å‘½ä»¤, è¿˜å¯ä»¥ä½¿ç”¨å®˜æ–¹æä¾›çš„ RedLock åˆ†å¸ƒå¼é”å®ç°</p>
<p>åœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹ï¼Œæ— æ³•ä½¿ç”¨å•æœºç¯å¢ƒä¸‹çš„é”å®ç°ã€‚å½“å¤šä¸ªèŠ‚ç‚¹ä¸Šçš„è¿›ç¨‹éƒ½éœ€è¦è·å–åŒä¸€ä¸ªé”æ—¶ï¼Œå°±éœ€è¦ä½¿ç”¨åˆ†å¸ƒå¼é”æ¥è¿›è¡ŒåŒæ­¥ã€‚</p>
<p>setnx key valueï¼Œå½“keyä¸å­˜åœ¨æ—¶ï¼Œå°† key çš„å€¼è®¾ä¸º value ï¼Œè¿”å›1ã€‚è‹¥ç»™å®šçš„ key å·²ç»å­˜åœ¨ï¼Œåˆ™setnxä¸åšä»»ä½•åŠ¨ä½œï¼Œè¿”å›0ã€‚å½“setnxè¿”å›1æ—¶ï¼Œè¡¨ç¤ºè·å–é”ï¼Œåšå®Œæ“ä½œä»¥ådel keyï¼Œè¡¨ç¤ºé‡Šæ”¾é”ï¼Œå¦‚æœsetnxè¿”å›0è¡¨ç¤ºè·å–é”å¤±è´¥</p>
</li>
<li>
<p>åˆ†å¸ƒå¼idç”Ÿæˆ</p>
<p>å› ä¸º redis å•çº¿ç¨‹çš„æ’ä»–æ€§, ä¿è¯çš„ç”Ÿæˆid çš„å”¯ä¸€, æ¯æ¬¡å…ˆ+1å†è·å–</p>
<p>æ”¹è¿›: æ¯æ¬¡å…ˆ+1000å†è·å–, æ‹¿åˆ°æœ¬åœ°å, 0~1000 æ…¢æ…¢ç”¨, ç”¨å®Œäº†å†è·å– 1001~2000, ä¸€ä¸ªç”¨æˆ·æœåŠ¡å®•æœºäº†ï¼Œä¹Ÿé¡¶å¤šä¸€å°æ®µuserIdæ²¡æœ‰ç”¨åˆ°</p>
</li>
<li>
<p>æ¶ˆæ¯é˜Ÿåˆ—</p>
<p>List æ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œå¯ä»¥é€šè¿‡ lpop å’Œ lpush å†™å…¥å’Œè¯»å–æ¶ˆæ¯ã€‚</p>
<p>ä¸è¿‡ä¸è§„å»ºä½¿ç”¨, æœ€å¥½ä½¿ç”¨ Kafkaã€RabbitMQ ç­‰æ¶ˆæ¯ä¸­é—´ä»¶ã€‚ä¸“ä¸šçš„äººåšä¸“ä¸šçš„äº‹</p>
</li>
<li>
<p>feed æµ</p>
<p>ä½¿ç”¨çš„æ˜¯ list ç±»å‹(æœ‰åºæ€§)</p>
</li>
<li>
<p>ç‚¹èµ/likeåŠŸèƒ½</p>
<p>åˆ©ç”¨ zet çš„å»é‡</p>
</li>
<li>
<p>å…±åŒå¥½å‹/å…±åŒå…³æ³¨</p>
<p>Set å¯ä»¥å®ç°äº¤é›†ã€å¹¶é›†ç­‰æ“ä½œ</p>
</li>
<li>
<p>æ’è¡Œæ¦œ</p>
<p>ZSet å¯ä»¥å®ç°æ›´å…·score æ’å, è€Œä¸”å¤©ç„¶å»é‡</p>
</li>
</ul>
<h1><a class="header" href="#rediså‘½ä»¤" id="rediså‘½ä»¤">rediså‘½ä»¤</a></h1>
<h2><a class="header" href="#ç³»ç»Ÿç®¡ç†å‘½ä»¤" id="ç³»ç»Ÿç®¡ç†å‘½ä»¤">ç³»ç»Ÿç®¡ç†å‘½ä»¤</a></h2>
<p>ä½äº<code>/usr/local/bin</code></p>
<pre><code class="language-sh">#         å¯åŠ¨

redis-server # é»˜è®¤æ–¹å¼å¯åŠ¨
redis-server --port 6379 [...] # æŒ‡å®šé…ç½®é¡¹å¯åŠ¨
redis-server &lt;path_to_redis.conf&gt; # æŒ‡å®šé…ç½®æ–‡ä»¶å¯åŠ¨ï¼Œ ä¸€èˆ¬å­˜åˆ° /opt/redis/redis.conf

#         è¿æ¥ åœæ­¢

redis-cli -h &lt;host&gt; -p &lt;port&gt; # é»˜è®¤ 127.0.0.1ï¼š6379
redis-cli shutdown [nosave|save] # å…³é—­ï¼Œ æ˜¯å¦æŒä¹…åŒ–
</code></pre>
<p>é…ç½®æ–‡ä»¶ç±»ä¼¼å¦‚ä¸‹ï¼š</p>
<pre><code class="language-conf">bind 127.0.0.1
port 6379
logfile xxx # æ—¥å¿—æ–‡ä»¶
dir xxx # redis å·¥ä½œç›®å½•ï¼Œ å­˜æ”¾æŒä¹…åŒ–æ–‡ä»¶
daemonize xxx # æ˜¯å¦ä»¥å®ˆæŠ¤è¿›ç¨‹æ–¹å¼å¯åŠ¨

</code></pre>
<h2><a class="header" href="#æ•°æ®æ“ä½œå‘½ä»¤" id="æ•°æ®æ“ä½œå‘½ä»¤">æ•°æ®æ“ä½œå‘½ä»¤</a></h2>
<p>å‘½ä»¤æŸ¥è¯¢: http://redisdoc.com</p>
<p>è®°å¿†æ–¹å¼: https://my.oschina.net/u/3025423/blog/793649</p>
<pre><code class="language-sh">#        å…¨å±€

keys * # æ‰€æœ‰é”®ï¼Œ è€—æ—¶
dbsize # é”®æ€»æ•°ï¼Œ ä¸è€—æ—¶
exist &lt;key&gt; # æ˜¯å¦å­˜åœ¨
del key [key ...] # åˆ é™¤
expire &lt;key&gt; &lt;seconds&gt; # é”®è¿‡æœŸåˆ é™¤
ttl &lt;key&gt; # å‰©ä½™è¿‡æœŸæ—¶é—´ï¼Œ 0ï¼Œ -1ï¼Œ -2
type &lt;key&gt; # å€¼çš„ç±»å‹

</code></pre>
<h2><a class="header" href="#é”®ç®¡ç†" id="é”®ç®¡ç†">é”®ç®¡ç†</a></h2>
<pre><code class="language-sh"># é”®é‡å‘½å
# rename key newKey é”®é‡å‘½å, å¦‚æœ newkey å·²ç»å­˜åœ¨, ä¼šè¢«è¦†ç›–
# ä¸ºäº†é˜²æ­¢è¢«è¦†ç›–, renamenx å‘½ä»¤ : è¡¨ç¤ºå¦‚æœ newKey ä¸å­˜åœ¨æ‰å¯rename æˆåŠŸ

# éšæœºæŒ‘é€‰ä¸€ä¸ª é”® randomkey

# é”®çš„è¿‡æœŸæ—¶é—´
# å¯¹äºæ•£åˆ—è¡¨è¿™ç§å®¹å™¨ï¼Œåªèƒ½ä¸ºæ•´ä¸ªé”®è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆæ•´ä¸ªæ•£åˆ—è¡¨ï¼‰ï¼Œè€Œä¸èƒ½ä¸ºé”®é‡Œé¢çš„å•ä¸ªå…ƒç´ è®¾ç½®è¿‡æœŸæ—¶é—´ã€‚
# é€šè¿‡ set åœ¨åˆå§‹åŒ–æ—¶è®¾ç½®è¿‡æœŸæ—¶é—´ or é€šè¿‡ setex
set key value [ex seconds] [px milliseconds] [nx|xx]
# expire key seconds ç§’çº§åˆ«è¿‡æœŸ; key ä¸å­˜åœ¨, è¿”å›0; è®¾ç½®è¿‡æœŸä¸ºè´Ÿå€¼, ç­‰åŒäº del (ç«‹å³åˆ é™¤)
# expireat key timestamp ç§’çº§åˆ«æ—¶é—´æˆ³åè¿‡æœŸ
# pexpire key milliseconds æ¯«ç§’çº§åˆ«è¿‡æœŸ
# pexpireat key milliseconds-timestamp æ¯«ç§’æ—¶é—´æˆ³ ----- æœ€ç»ˆåº•å±‚éƒ½æ˜¯è°ƒç”¨è¿™ä¸ªå‘½ä»¤
# ttl key è§‚å¯Ÿå‰©ä½™æ—¶é—´; pttl æ›´ç²¾ç¡®(æ¯«ç§’çº§åˆ«)
# persist key å–æ¶ˆè¿‡æœŸæ—¶é—´

# é”®çš„è¿ç§» 
# å°†éƒ¨åˆ†æ•°æ®ä»ä¸€ä¸ªredisè¿ç§»åˆ°å¦ä¸€ä¸ª redis
# æ–¹æ³•æœ‰ä¸‰: move; dump+restore; migrate
# `move key db` 
# `dump key`åœ¨æºredisä¸Šå°†æ•°æ®åºåˆ—åŒ–æˆ RDBæ ¼å¼ + `restore key ttl value`åœ¨ç›®æ ‡redisä¸Šå°†æ•°æ®å¤åŸ, ttl è¡¨ç¤ºè¿‡æœŸæ—¶é—´, tto=0è¡¨ç¤ºæ²¡æœ‰è¿‡æœŸæ—¶é—´
# migrate host port key|&quot;&quot; target-db timeout [copy] [replace] [key key...]

# éå†é”®
# `keys pattern` æ”¯æŒglobé€šé…ç¬¦ - è€—æ—¶
# æ¸è¿›å¼éå† `scan cursor [match pattern] [count number]` 
# 

# å¤šæ•°æ®åº“ç®¡ç†
# `select dbIndex` åˆ‡æ¢æ•°æ®åº“, ä»0å¼€å§‹
# flushdb/flushall æ¸…é™¤/æ¸…é™¤å…¨éƒ¨


</code></pre>
<h1><a class="header" href="#æ•°æ®ç±»å‹" id="æ•°æ®ç±»å‹">æ•°æ®ç±»å‹</a></h1>
<p>https://www.cnblogs.com/javazhiyin/p/11063944.html</p>
<p>é”®çš„ç±»å‹åªèƒ½ä¸ºå­—ç¬¦ä¸²ï¼Œå€¼æ”¯æŒçš„<code>äº”ç§æ•°æ®ç±»å‹</code>ä¸ºï¼šå­—ç¬¦ä¸²(string)ã€åˆ—è¡¨(list)ã€é›†åˆ(set)ã€æœ‰åºé›†åˆ(zset)ã€æ•£åˆ—è¡¨(hash)ã€‚</p>
<p><img src="Snipaste_2018-07-19_16-09-13.png" alt="alt" /></p>
<p><img src="Snipaste_2018-12-08_16-01-44.png" alt="alt" /><img src="Snipaste_2018-12-08_16-03-03.png" alt="alt" /></p>
<p>æ¯ç§æ•°æ®ç±»å‹åœ¨redis å†…éƒ¨æœ‰è‡ªå·±çš„ç¼–ç å®ç°, å†…éƒ¨çš„ç¼–ç å®ç°æœ‰æ”¹è¿›ä¸ä¼šå¯¹å¤–éƒ¨æœ‰ä»€ä¹ˆå½±å“, å¤šç§å†…éƒ¨ç¼–ç å®ç°å¯ä»¥å¯¹åº”ä¸åŒåº”ç”¨åœºæ™¯</p>
<h2><a class="header" href="#streaming-ç±»å‹" id="streaming-ç±»å‹">streaming ç±»å‹</a></h2>
<p>https://lolico.me/2020/06/28/Using-stream-to-implement-message-queue-in-springboot/
TODO</p>
<p>Redis5æ–°å¢äº†ä¸€ä¸ªStreamçš„æ•°æ®ç±»å‹ï¼Œè¿™ä¸ªç±»å‹ä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—æ¥ä½¿ç”¨æ—¶å¼¥è¡¥äº†Listå’ŒPub/Subçš„ä¸è¶³å¹¶ä¸”æä¾›äº†æ›´å¼ºå¤§çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ackæœºåˆ¶ä»¥åŠæ¶ˆè´¹è€…ç»„ç­‰æ¦‚å¿µ</p>
<h2><a class="header" href="#string-å­—ç¬¦ä¸²" id="string-å­—ç¬¦ä¸²">String-å­—ç¬¦ä¸²</a></h2>
<p>Stringæ•°æ®ç»“æ„æ˜¯ç®€å•çš„key-valueç±»å‹ï¼Œvalueå…¶å®ä¸ä»…å¯ä»¥æ˜¯Stringï¼Œä¹Ÿå¯ä»¥æ˜¯æ•°å­—ã€‚ å¸¸è§„key-valueç¼“å­˜åº”ç”¨ï¼› å¸¸è§„è®¡æ•°ï¼šå¾®åšæ•°ï¼Œç²‰ä¸æ•°ç­‰ã€‚</p>
<pre><code class="language-sh"># å¸¸ç”¨å‘½ä»¤: set,get,decr,incr,mget ç­‰

## è®¾ç½®å€¼ , è¿‡æœŸæ—¶é—´
## `set key value [ex seconds] [px milliseconds] [nx|xx]`
## è®¾ç½®ç§’/æ¯«ç§’çº§åˆ«è¿‡æœŸæ—¶é—´, 
## é”®å¿…é¡»å­˜åœ¨/ä¸å­˜åœ¨ æ‰èƒ½è®¾ç½®æˆåŠŸ, ç”¨äºæ·»åŠ /æ›´æ–° (ç­‰ä»· setnx setxx)
## setnx å®ç° åˆ†å¸ƒå¼é” (åŸç†: redisçš„å•çº¿ç¨‹æ¨¡å‹, setnx åªæœ‰ä¸€ä¸ªclient ä¼šè®¾ç½®æˆåŠŸ)

&gt; set hello world
OK

## è·å–å€¼
## getset key value è®¾ç½®è·å–åŸå€¼

&gt; get hello
&quot;world&quot;

# æ‰¹é‡è®¾ç½®, è·å–
127.0.0.1:6379&gt; mset a 1 b 2 c 3
OK
127.0.0.1:6379&gt; mget a b c
1) &quot;1&quot;
2) &quot;2&quot;
3) &quot;3&quot;

## è®¡æ•° 
## è‡ªå¢ `incr key`, å€¼ä¸æ˜¯æ•´æ•°, è¿”å›é”™è¯¯, å€¼æ˜¯æ•´æ•°åˆ™è¿”å›è‡ªå¢åçš„ç»“æœ, å€¼ä¸å­˜åœ¨è§†ä½œ0,è‡ªå¢åè¿”å›1
## è‡ªå‡ `decr key`
## incrby å’Œ decrby è‡ªå¢è‡ªå‡æŒ‡å®šæ•°å­—

# åˆ é™¤

&gt; del hello
(integer) 1
&gt; get hello
(null)

###########################################

# ä¸å¸¸ç”¨çš„å‘½ä»¤

## è¿½åŠ  `append key value` å‘ string å°¾éƒ¨è¿½åŠ å­—ç¬¦ä¸²
## é•¿åº¦ `strlen key` æ¯ä¸ªè‹±æ–‡å­—ç¬¦ 1 byte, ä¸­æ–‡ 3 byte
## è®¾ç½® æŒ‡å®šä½ç½®çš„ å­—ç¬¦ `setrange key offset value` åç§»é‡ä»0å¼€å§‹
## è·å¾— éƒ¨åˆ†å­—ç¬¦ä¸² `getrange key start end`
</code></pre>
<p>å‘½ä»¤çš„æ—¶é—´å¤æ‚åº¦</p>
<p>åœºæ™¯: </p>
<ul>
<li>ç¼“å­˜ - ä¸šåŠ¡å¯¹è±¡(å¦‚: User) éœ€è¦åºåˆ—åŒ–</li>
<li>è®¡æ•° - ç»Ÿè®¡æ’­æ”¾é‡ (çœŸå®çš„è®¡æ•°ç³»ç»Ÿéœ€è¦è€ƒè™‘: é˜²ä½œå¼Š, æ•°æ®æŒä¹…åŒ–)</li>
<li>å…±äº«session - åˆ†å¸ƒå¼åº”ç”¨</li>
<li>é™æµ - ä¾‹å¦‚æ¯åˆ†é’Ÿä¸èƒ½è®¿é—®è¶…è¿‡10æ¬¡, åŒä¸€ä¸ªipåœ°å€ä¸èƒ½åœ¨1ç§’å†…è®¿é—®è¶…è¿‡næ¬¡</li>
</ul>
<h2><a class="header" href="#list-åˆ—è¡¨" id="list-åˆ—è¡¨">List-åˆ—è¡¨</a></h2>
<p><img src="Snipaste_2018-07-19_16-13-36.png" alt="alt" /><img src="Snipaste_2018-12-09_13-37-01.png" alt="alt" /></p>
<p>å…è®¸é‡å¤;</p>
<p>Redis listçš„å®ç°ä¸ºä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œå³å¯ä»¥æ”¯æŒåå‘æŸ¥æ‰¾å’Œéå†; </p>
<p>åœºæ™¯: </p>
<ul>
<li>
<p>æ¶ˆæ¯é˜Ÿåˆ—; lpush å’Œ brpop ç»“åˆå¯å®ç°é˜»å¡é˜Ÿåˆ—</p>
</li>
<li>
<p>æ–‡ç« åˆ—è¡¨</p>
<p>æ¯ç¯‡æ–‡ç« ä½¿ç”¨ hash ç±»å‹å­˜å‚¨; ç”¨æˆ·æ–‡ç« åˆ—è¡¨ä½¿ç”¨ list ç±»å‹å­˜å‚¨</p>
</li>
</ul>
<pre><code class="language-sh"># å¸¸ç”¨å‘½ä»¤: lpush,rpush,lpop,rpop,lrangeç­‰

######## æ·»åŠ  lpush rpush linsert ##########

# rpush rå³right, åœ¨Listä¸­ä»å³å‘å·¦æ’å…¥å…ƒç´  (ä¸€æ—¦ä½¿ç”¨è¯¥å‘½ä»¤ï¼ŒListå°±ä»£è¡¨æ˜¯ä¸€ä¸ªåˆ—è¡¨è€Œä¸æ˜¯ä¸€ä¸ªå˜é‡ï¼Œå¯¹å…¶ä½¿ç”¨getæ–¹æ³•ä¼šæŠ¥é”™)

&gt; rpush list-key item
(integer) 1
&gt; rpush list-key item2
(integer) 2
&gt; rpush list-key item # å…è®¸é‡å¤å…ƒç´ 
(integer) 3

127.0.0.1:6379&gt; rpush list c b a
(integer) 3
127.0.0.1:6379&gt; lrange list 0 -1 # éå†
1) &quot;c&quot;
2) &quot;b&quot;
3) &quot;a&quot;

# linsert key before|after pivot value åœ¨ pivot å‰/å æ’å…¥ value


############# æŸ¥æ‰¾ lrange lindex llen ###########################

# lrange key start end å·¦å³é—­åŒºé—´
# ç´¢å¼•ä»å·¦åˆ°å³ 0 ~ (N-1) ; ä»å³åˆ°å·¦ -1 ~ -N
&gt; lrange list-key 0 -1     # indexä» 0 å¼€å§‹, -1 è¡¨ç¤ºç›´åˆ°æœ«å°¾
1) &quot;item&quot;
2) &quot;item2&quot;
3) &quot;item&quot;

# lindex key index è·å– index å¤„çš„å…ƒç´ 
127.0.0.1:6379&gt; lindex list -1 # æœ€åä¸€ä¸ªå…ƒç´ 
&quot;a&quot;

# llen key åˆ—è¡¨é•¿åº¦


########## åˆ é™¤ lpop rpop lrem ltrim ################

# lpop lè¡¨ç¤ºleft, è¿”å›å¹¶åˆ é™¤keyListä¸­çš„ç¬¬ä¸€ä¸ªvalueå€¼ (åˆ é™¤å·¦è¾¹ç¬¬ä¸€ä¸ª)
# rpop key ä»å³è¾¹å¼¹å‡ºä¸€ä¸ª

&gt; lpop list-key
&quot;item&quot;

# lrem key count value åˆ é™¤å€¼ä¸º value çš„ å…ƒç´ 
# count &gt; 0, ä»å·¦åˆ°æœ‰åˆ é™¤æœ€å¤š countä¸ª; count &lt; 0, ä»å³åˆ°å·¦åˆ é™¤æœ€å¤š |count| ä¸ª; count = 0, åˆ é™¤æ‰€æœ‰.
# ltrim key start end å–å­åˆ—è¡¨


###############ä¿®æ”¹ lset##################

# lset key index value ä¿®æ”¹index å¤„çš„å…ƒç´ 

################## é˜»å¡å¼å¼¹å‡º blpop brpop ###################

# blpop key [key...] timeout ç­‰å¾…ç›´åˆ°æœ‰å…ƒç´ è¿”å›, å•ä½ s
# åˆ—è¡¨ä¸º nil, ç­‰å¾… timeoutç§’åè¿”å›, å¦‚æœtimeout=0, ä¸€ç›´ç­‰å¾…ä¸‹å»; å¦‚æœåœ¨æ­¤æœŸé—´æœ‰æ–°çš„å…ƒç´ æ·»åŠ , ç«‹å³è¿”å›è¿™ä¸ªæ–°å…ƒç´ 
# åˆ—è¡¨ä¸ä¸ºnil, ç«‹å³è¿”å›ç»“æœ
</code></pre>
<h2><a class="header" href="#set-é›†åˆ" id="set-é›†åˆ">Set-é›†åˆ</a></h2>
<p><img src="Snipaste_2018-07-19_16-47-33.png" alt="alt" /></p>
<p>æ— åºä¸å¯é‡å¤</p>
<p>setæä¾›äº†åˆ¤æ–­æŸä¸ªæˆå‘˜æ˜¯å¦åœ¨ä¸€ä¸ªseté›†åˆå†…çš„é‡è¦æ¥å£ï¼Œè¿™ä¸ªä¹Ÿæ˜¯listæ‰€ä¸èƒ½æä¾›çš„</p>
<p>å–äº¤é›†, å¹¶é›†</p>
<p><img src="Snipaste_2018-12-09_19-07-10.png" alt="alt" /></p>
<pre><code class="language-sh">
# æ·»åŠ  sadd key element [element...]
# sadd så³ä¸ºSetï¼ŒSet add valueçš„æ„æ€, ç»™keySetæ’å…¥valueï¼ŒSeté›†åˆæ˜¯æ— åºçš„ï¼Œæ²¡æœ‰å¤´éƒ¨å’Œå°¾éƒ¨

&gt; sadd set-key item
(integer) 1
&gt; sadd set-key item2
(integer) 1
&gt; sadd set-key item3
(integer) 1
&gt; sadd set-key item         # é‡å¤, ä¸å¯æ’å…¥
(integer) 0

# smembers key é›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ 
# s=Setï¼Œmemberså³åœ¨Seté›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ ,  è¿”å›keysetä¸­æ‰€æœ‰çš„valueå€¼

&gt; smembers set-key
1) &quot;item&quot;
2) &quot;item2&quot;
3) &quot;item3&quot;

# åˆ¤æ–­æ˜¯å¦å­˜åœ¨ sismember key element
# s=Setï¼Œismemberå³æŸä¸ªå…ƒç´ æ˜¯å¦åœ¨Seté›†åˆçš„å†…å­˜ä¸­

&gt; sismember set-key item4
(integer) 0     # ä¸å­˜åœ¨
&gt; sismember set-key item
(integer) 1     # å­˜åœ¨

# srandmember key [count] éšæœºè¿”å›countä¸ªæ•°çš„å…ƒç´ , é»˜è®¤è¿”å›1ä¸ª

# ç§»é™¤ srem key element [element...]
# srem å³Set remove, åˆ é™¤keySetä¸­æŒ‡å®šçš„valueå€¼

&gt; srem set-key item2
(integer) 1
&gt; srem set-key item2
(integer) 0

&gt; smembers set-key
1) &quot;item&quot;
2) &quot;item3&quot;

# å…ƒç´ ä¸ªæ•° scard key

# spop key [count] éšæœºå¼¹å‡ºä¸€ä¸ªå…ƒç´ 

############ é›†åˆé—´çš„æ“ä½œ #############################

# äº¤é›† sinter key [key...]

# å¹¶é›† sunion key [key...]

# å·®é›† sdiff key [key...]


</code></pre>
<p>åœºæ™¯:</p>
<ul>
<li>
<p>æ ‡ç­¾ - sadd</p>
<p>ç»™ç”¨æˆ·æ·»åŠ æ ‡ç­¾ ; ç»™æ ‡ç­¾æ·»åŠ ç”¨æˆ·</p>
<p>æ·»åŠ è¿‡ç¨‹åº”è¯¥åœ¨åŒä¸ªäº‹åŠ¡ä¸­å®Œæˆ, è‡³äºå¦‚ä½•å®ç°, å¯é€šè¿‡ redis äº‹åŠ¡, or é€šè¿‡ lua è„šæœ¬</p>
</li>
<li>
<p>ç”Ÿæˆéšæœºæ•°, å¦‚æŠ½å¥– - spop/srandmember</p>
</li>
<li>
<p>ç¤¾äº¤éœ€æ±‚ - sadd + sinter</p>
</li>
</ul>
<h2><a class="header" href="#hash-å“ˆå¸Œ" id="hash-å“ˆå¸Œ">Hash-å“ˆå¸Œ</a></h2>
<p><img src="Snipaste_2018-07-19_16-53-24.png" alt="alt" /></p>
<p>é€‚åˆç”¨äºå­˜å‚¨å¯¹è±¡; ä¸¾ä¸ªä¾‹å­ğŸŒ°ï¼š ä¸€ä¸ªç”µå•†ç½‘ç«™é¡¹ç›®çš„é¦–é¡µå°±ä½¿ç”¨äº†redisçš„hashæ•°æ®ç»“æ„è¿›è¡Œç¼“å­˜</p>
<pre><code class="language-sh"># å¸¸ç”¨å‘½ä»¤ï¼š hget,hset,hgetall ç­‰ã€‚

# HSET key field value å°†å“ˆå¸Œè¡¨ key ä¸­çš„åŸŸ field çš„å€¼è®¾ä¸º value

&gt; hset hash-key sub-key1 value1
(integer) 1
&gt; hset hash-key sub-key2 value2
(integer) 1
&gt; hset hash-key sub-key1 value1     # å¦‚æœåŸŸ field å·²ç»å­˜åœ¨äºå“ˆå¸Œè¡¨ä¸­ï¼Œæ—§å€¼å°†è¢«è¦†ç›–
(integer) 0

# hgetall å³ hash get all, æ ¹æ®hashçš„key, è·å– fieldå’Œfield_value, è¿”å›list, é•¿åº¦ä¸ºhashçš„2å€

&gt; hgetall hash-key
1) &quot;sub-key1&quot;     # field
2) &quot;value1&quot;       # filed value
3) &quot;sub-key2&quot;
4) &quot;value2&quot;

# åˆ é™¤

&gt; hdel hash-key sub-key2
(integer) 1 # è¿”å›ç»“æœä¸º æˆåŠŸåˆ é™¤çš„ field ä¸ªæ•°
&gt; hdel hash-key sub-key2
(integer) 0

# hget è·å–æŒ‡å®šfiledçš„å€¼

&gt; hget hash-key sub-key1
&quot;value1&quot;

&gt; hgetall hash-key
1) &quot;sub-key1&quot;
2) &quot;value1&quot;

# hlen key è®¡ç®—field ä¸ªæ•°

# æ‰¹é‡è®¾ç½® æ‰¹é‡è·å– field value
# hmget key field [field...]
# hmset key field value [field value]

# hexists key field åˆ¤æ–­fieldæ˜¯å¦å­˜åœ¨

# hkeys key è¿”å›æ‰€æœ‰ field
# hvals key è¿”å›æ‰€æœ‰ value
# hgetall key è¿”å› æ‰€æœ‰ field-value

# hstrlen key field  è®¡ç®— field é•¿åº¦

</code></pre>
<p>hash è¿™ç§ç±»å‹å’Œç»“æ„åŒ–æ•°æ®åº“çš„è¡¨æœ€ç±»ä¼¼, key è®°å½•ä¸º id, valueå°±æ˜¯ä¸€è¡Œæ•°æ®. ä¹Ÿæœ‰ä¸åŒä¹‹å¤„: hash æ¯ä¸ª key å¯ä»¥æœ‰ä¸åŒçš„ field. è€Œå…³ç³»å‹æ•°æ®åº“ä¸€æ—¦æ·»åŠ æ–°çš„ &quot;åˆ—&quot;, æ¯è¡Œæ•°æ®éƒ½è¦èµ‹å€¼, å³ä½¿æ˜¯ null; å…³ç³»å‹æ•°æ®åº“æ–¹ä¾¿è¿›è¡Œå…³ç³»æŸ¥è¯¢, è€Œ redis ä¸­çš„ hash æ¨¡æ‹Ÿ å¤æ‚æŸ¥è¯¢å°±å¾ˆéº»çƒ¦</p>
<p>åœºæ™¯: ç¼“å­˜. ç›¸å¯¹äºç›´æ¥ä½¿ç”¨String ç±»å‹ä½¿ä¸šåŠ¡å¯¹è±¡ç³»åˆ—åŒ–æ„å»ºç¼“å­˜, ä½¿ç”¨ hash æ„é€ ç¼“å­˜æ›´ç›´è§‚, æ›´æ–°æ“ä½œæ›´ä¾¿æ·</p>
<p>è‡³æ­¤, å¯¹äº ç¼“å­˜åœºæ™¯, æœ‰ 3ç§æ–¹æ¡ˆ:</p>
<ul>
<li>
<p>ä½¿ç”¨ string ç±»å‹, æ¯ä¸ª key-value å°±æ˜¯ä¸€ä¸ªå±æ€§ eg: <code>set usre:1:name xy</code>, <code>set user:1:age 18</code> ...</p>
<p>è¿™ç§æœ€ç®€å•, å†…å­˜å ç”¨æœ€å¤§, å› ä¸º key çš„å†—ä½™å†…å®¹è¾ƒå¤š</p>
</li>
<li>
<p>ä½¿ç”¨ string ç±»å‹, å°†ä¸€ä¸ªä¸šåŠ¡å¯¹è±¡åºåˆ—åŒ–ç„¶åç”¨ä¸€ä¸ª é”®å€¼å¯¹ä¿å­˜</p>
<p>å†…å­˜å ç”¨ä¸å¤š, ä½†æ˜¯åºåˆ—åŒ–ååºåˆ—åŒ–æœ‰æ—¶é—´å¼€é”€, å°¤å…¶ æ›´æ–° æ“ä½œçš„æ—¶å€™, å¾ˆéº»çƒ¦</p>
</li>
<li>
<p>ä½¿ç”¨ hash ç±»å‹, æ¯ä¸ª é”®å€¼å¯¹ä¿å­˜ä¸€ä¸ªä¸šåŠ¡å¯¹è±¡,  å±æ€§ é€šè¿‡ field-value å¯¹ä¿å­˜</p>
</li>
</ul>
<h2><a class="header" href="#zset-æœ‰åºé›†åˆ" id="zset-æœ‰åºé›†åˆ">ZSet-æœ‰åºé›†åˆ</a></h2>
<p><img src="Snipaste_2018-07-19_17-03-19.png" alt="alt" /></p>
<p>ç±»ä¼¼ set , <code>å…ƒç´ ä¸å¯é‡å¤</code> (åˆ†æ•°å¯ä»¥é‡å¤); æ­¤å¤–, sorted setå¢åŠ äº†ä¸€ä¸ªæƒé‡å‚æ•°scoreï¼Œä½¿å¾—é›†åˆä¸­çš„å…ƒç´ èƒ½å¤ŸæŒ‰scoreè¿›è¡Œ<code>æœ‰åºæ’åˆ—</code></p>
<p>åœºæ™¯: åœ¨ç›´æ’­ç³»ç»Ÿä¸­ï¼Œå®æ—¶æ’è¡Œä¿¡æ¯åŒ…å«ç›´æ’­é—´åœ¨çº¿ç”¨æˆ·åˆ—è¡¨ï¼Œå„ç§ç¤¼ç‰©æ’è¡Œæ¦œ</p>
<pre><code class="language-sh">
# æ·»åŠ  zadd key score member [score member ...]
# å››ä¸ªé€‰é¡¹: nx: memberå¿…é¡»ä¸å­˜åœ¨æ‰å¯æˆåŠŸ, ç”¨äº æ·»åŠ ; xx: memberå¿…é¡»å­˜åœ¨æ‰å¯æˆåŠŸ, ç”¨äº ä¿®æ”¹; ch: å…ƒç´ å‘ç”Ÿå˜åŒ–çš„ä¸ªæ•° ; incr: å¯¹ score è‡ªå¢
# 728 æ˜¯åˆ†æ•°, score å€¼å¯ä»¥æ˜¯æ•´æ•°å€¼æˆ–åŒç²¾åº¦æµ®ç‚¹æ•°(å¦‚æœæŸä¸ª member å·²ç»æ˜¯æœ‰åºé›†çš„æˆå‘˜ï¼Œé‚£ä¹ˆæ›´æ–°è¿™ä¸ª member çš„ score å€¼)
&gt; zadd zset-key 728 member1
(integer) 1
&gt; zadd zset-key 982 member0
(integer) 1
&gt; zadd zset-key 982 member0     # memberä¸€æ ·, scoreä¹Ÿä¸€æ ·, æ— æ³•æ’å…¥, æ— æ³•æ›´æ–°score
(integer) 0

# å…ƒç´ ä¸ªæ•° zcard key

# è®¡ç®—æŸä¸ªå…ƒç´ çš„åˆ†æ•° zscore key member 

# è®¡ç®—æŸä¸ªæˆå‘˜æ’å zrank/zrevrank key member æ­£æ•°/å€’æ•°

# zrem key member [member...]

# å¢åŠ åˆ†æ•° zincrby key increment member åˆ†æ•°å¢åŠ increment

# è·å–æŒ‡å®šæ’åèŒƒå›´çš„å…ƒç´  zrange/zrevrange key start end [withscores] ä»ä½åˆ°é«˜/ä»é«˜åˆ°ä½

&gt; zrange zset-key 0 -1 withscores # å…¨èŒƒå›´
1) &quot;member1&quot;
2) &quot;728&quot;
3) &quot;member0&quot;
4) &quot;982&quot;

# è·å–æŒ‡å®šåˆ†æ•°èŒƒå›´çš„å…ƒç´  zrangbyscore/zrevrangebyscore key min max [withscores] [limit offset count]
# min max æ”¯æŒ å¼€é—­åŒºé—´ (å°æ‹¬å·, ä¸­æ‹¬å·), æ­£è´Ÿæ— ç©· (+-inf)
&gt; zrangebyscore zset-key 0 800 withscores
1) &quot;member1&quot;
2) &quot;728&quot;

# åˆ é™¤ zrem key member
# åˆ é™¤æŒ‡å®šæ’åèŒƒå›´å†…çš„æ‰€æœ‰å…ƒç´  (å‡åº) zremrangebyrank key start end
# åˆ é™¤æŒ‡å®šåˆ†æ•°èŒƒå›´å†…çš„å…ƒç´  (å‡åº) zremrangebyscore key min max

&gt; zrem zset-key member1
(integer) 1
&gt; zrem zset-key member1
(integer) 0

# è¿”å›æŒ‡å®šåˆ†æ•°èŒƒå›´å…ƒç´ ä¸ªæ•° zcount key min max

############## é›†åˆé—´æ“ä½œ ################################

#äº¤é›† zinterstore
#å¹¶é›† zunionstore
</code></pre>
<h1><a class="header" href="#luaè„šæœ¬" id="luaè„šæœ¬">luaè„šæœ¬</a></h1>
<h1><a class="header" href="#å•çº¿ç¨‹æ¶æ„" id="å•çº¿ç¨‹æ¶æ„">å•çº¿ç¨‹æ¶æ„</a></h1>
<p>ä¸å­˜åœ¨å¹¶å‘æ‰§è¡Œå‘½ä»¤</p>
<ul>
<li>çº¯å†…å­˜è®¿é—®</li>
<li>éé˜»å¡io - epoll å®ç°ioå¤šè·¯å¤ç”¨</li>
<li>å•çº¿ç¨‹æ²¡æœ‰ä¸Šä¸‹æ–‡åˆ‡æ¢</li>
</ul>
<h1><a class="header" href="#å†…å­˜æ·˜æ±°æœºåˆ¶" id="å†…å­˜æ·˜æ±°æœºåˆ¶">å†…å­˜æ·˜æ±°æœºåˆ¶</a></h1>
<p>å¯ä»¥è®¾ç½®å†…å­˜æœ€å¤§ä½¿ç”¨é‡ï¼Œå½“å†…å­˜ä½¿ç”¨é‡è¶…è¿‡æ—¶æ–½è¡Œæ·˜æ±°ç­–ç•¥ï¼Œå…·ä½“æœ‰ 6 ç§æ·˜æ±°ç­–ç•¥ã€‚</p>
<p><img src="Snipaste_2018-07-20_12-08-58.png" alt="alt" /></p>
<h2><a class="header" href="#ä¸‰é“ä¿é™©ä¿è¯-key-è¿‡æœŸå¤„ç†" id="ä¸‰é“ä¿é™©ä¿è¯-key-è¿‡æœŸå¤„ç†">ä¸‰é“ä¿é™©ä¿è¯ key è¿‡æœŸå¤„ç†</a></h2>
<p>å®šæœŸåˆ é™¤+æƒ°æ€§åˆ é™¤</p>
<p>å®šæœŸåˆ é™¤: redisæ˜¯æ¯éš”100mséšæœºæŠ½å–ä¸€äº›keyæ¥æ£€æŸ¥å’Œåˆ é™¤</p>
<p>æƒ°æ€§åˆ é™¤: è·å–æŸä¸ªkeyçš„æ—¶å€™ï¼Œredisä¼šæ£€æŸ¥ä¸€ä¸‹ ï¼Œè¿™ä¸ªkeyå¦‚æœè®¾ç½®äº†è¿‡æœŸæ—¶é—´é‚£ä¹ˆæ˜¯å¦è¿‡æœŸäº†ï¼Ÿå¦‚æœè¿‡æœŸäº†æ­¤æ—¶å°±ä¼šåˆ é™¤</p>
<p>é€šè¿‡ä¸Šè¿°ä¸¤ç§æ‰‹æ®µç»“åˆèµ·æ¥ï¼Œä¿è¯è¿‡æœŸçš„keyä¸€å®šä¼šè¢«å¹²æ‰</p>
<p>ä½†æ˜¯å®é™…ä¸Šè¿™è¿˜æ˜¯æœ‰é—®é¢˜çš„ï¼Œå¦‚æœå®šæœŸåˆ é™¤æ¼æ‰äº†å¾ˆå¤šè¿‡æœŸkeyï¼Œç„¶åä½ ä¹Ÿæ²¡åŠæ—¶å»æŸ¥ï¼Œä¹Ÿå°±æ²¡èµ°æƒ°æ€§åˆ é™¤; æ­¤æ—¶ä¼šèµ°å†…å­˜æ·˜æ±°æœºåˆ¶</p>
<h2><a class="header" href="#æœ‰å“ªäº›æ·˜æ±°æœºåˆ¶" id="æœ‰å“ªäº›æ·˜æ±°æœºåˆ¶">æœ‰å“ªäº›æ·˜æ±°æœºåˆ¶</a></h2>
<ul>
<li>
<p>noeviction(é»˜è®¤ç­–ç•¥)ï¼šå†…å­˜æ»¡äº†, å¯¹äºå†™è¯·æ±‚ä¸å†æä¾›æœåŠ¡ï¼Œç›´æ¥è¿”å›é”™è¯¯, æ²¡äººç”¨</p>
</li>
<li>
<p>allkeys-lruï¼šä»æ‰€æœ‰keyä¸­ä½¿ç”¨LRUç®—æ³•è¿›è¡Œæ·˜æ±° (å¸¸ç”¨)</p>
</li>
<li>
<p>allkeys-randomï¼šä»æ‰€æœ‰keyä¸­éšæœºæ·˜æ±°æ•°æ® (æ²¡äººç”¨)</p>
</li>
<li>
<p>volatile-lruï¼šä»è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„keyä¸­ä½¿ç”¨LRUç®—æ³•è¿›è¡Œæ·˜æ±° </p>
</li>
<li>
<p>volatile-randomï¼šä»è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„keyä¸­éšæœºæ·˜æ±°</p>
</li>
<li>
<p>volatile-ttlï¼šåœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„keyä¸­ï¼Œæ ¹æ®keyçš„è¿‡æœŸæ—¶é—´è¿›è¡Œæ·˜æ±°ï¼Œæœ‰æ›´æ—©è¿‡æœŸæ—¶é—´çš„keyä¼˜å…ˆç§»é™¤</p>
</li>
</ul>
<p>volatile-xx çš„ä¸€èˆ¬ä¸ç”¨</p>
<h2><a class="header" href="#å†…å­˜å›æ”¶ç®—æ³•" id="å†…å­˜å›æ”¶ç®—æ³•">å†…å­˜å›æ”¶ç®—æ³•</a></h2>
<p>Redisä¸­é‡‡ç”¨ä¸¤ç§ç®—æ³•è¿›è¡Œå†…å­˜å›æ”¶ï¼Œå¼•ç”¨è®¡æ•°ç®—æ³•ä»¥åŠLRUç®—æ³•;</p>
<p>å¦‚æœä½¿ç”¨ Redis æ¥ç¼“å­˜æ•°æ®æ—¶ï¼Œè¦ä¿è¯æ‰€æœ‰æ•°æ®éƒ½æ˜¯çƒ­ç‚¹æ•°æ®ï¼Œå¯ä»¥å°†å†…å­˜æœ€å¤§ä½¿ç”¨é‡è®¾ç½®ä¸ºçƒ­ç‚¹æ•°æ®å ç”¨çš„å†…å­˜é‡ï¼Œç„¶åå¯ç”¨ allkeys-lru æ·˜æ±°ç­–ç•¥ï¼Œå°†æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®æ·˜æ±°ã€‚</p>
<p>ä½œä¸ºå†…å­˜æ•°æ®åº“ï¼Œå‡ºäºå¯¹æ€§èƒ½å’Œå†…å­˜æ¶ˆè€—çš„è€ƒè™‘ï¼ŒRedis çš„æ·˜æ±°ç®—æ³•ï¼ˆLRUã€TTLï¼‰å®é™…å®ç°ä¸Šå¹¶éé’ˆå¯¹æ‰€æœ‰ keyï¼Œè€Œæ˜¯æŠ½æ ·ä¸€å°éƒ¨åˆ† key ä»ä¸­é€‰å‡ºè¢«æ·˜æ±° key.</p>
<p>LRU(Least Recently Used)ï¼Œå³æœ€è¿‘æœ€å°‘ä½¿ç”¨, æ ¹æ®keyçš„æœ€è¿‘è¢«è®¿é—®çš„é¢‘ç‡è¿›è¡Œæ·˜æ±°ï¼Œå¾ˆå°‘è¢«è®¿é—®çš„ä¼˜å…ˆè¢«æ·˜æ±°ï¼Œè¢«è®¿é—®çš„å¤šçš„åˆ™è¢«ç•™ä¸‹æ¥ã€‚ <a href="https://www.cnblogs.com/lzrabbit/p/3734850.html">Java æä¾›çš„ LinkedHashMap å¯ä»¥å®ç°</a> //todo</p>
<h2><a class="header" href="#å¦‚ä½•é…ç½®æ·˜æ±°ç­–ç•¥" id="å¦‚ä½•é…ç½®æ·˜æ±°ç­–ç•¥">å¦‚ä½•é…ç½®æ·˜æ±°ç­–ç•¥</a></h2>
<h3><a class="header" href="#é€šè¿‡é…ç½®æ–‡ä»¶" id="é€šè¿‡é…ç½®æ–‡ä»¶">é€šè¿‡é…ç½®æ–‡ä»¶</a></h3>
<p>é€šè¿‡åœ¨Rediså®‰è£…ç›®å½•ä¸‹é¢çš„redis.conf</p>
<p>redisçš„é…ç½®æ–‡ä»¶ä¸ä¸€å®šä½¿ç”¨çš„æ˜¯å®‰è£…ç›®å½•ä¸‹é¢çš„redis.confæ–‡ä»¶ï¼Œå¯åŠ¨redisæœåŠ¡çš„æ—¶å€™æ˜¯å¯ä»¥ä¼ ä¸€ä¸ªå‚æ•°æŒ‡å®šredisçš„é…ç½®æ–‡ä»¶çš„</p>
<pre><code>//è®¾ç½®Redisæœ€å¤§å ç”¨å†…å­˜å¤§å°ä¸º100M
maxmemory 100mb
// æ·˜æ±°ç­–ç•¥
maxmemory-policy allkeys-lru
</code></pre>
<p>Redisä½¿ç”¨çš„æ˜¯è¿‘ä¼¼LRUç®—æ³•ï¼Œå®ƒè·Ÿå¸¸è§„çš„LRUç®—æ³•è¿˜ä¸å¤ªä¸€æ ·ã€‚è¿‘ä¼¼LRUç®—æ³•é€šè¿‡éšæœºé‡‡æ ·æ³•æ·˜æ±°æ•°æ®ï¼Œæ¯æ¬¡éšæœºå‡º5ï¼ˆé»˜è®¤ï¼‰ä¸ªkeyï¼Œä»é‡Œé¢æ·˜æ±°æ‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„keyã€‚</p>
<pre><code>// ä¿®æ”¹é‡‡æ ·æ•°é‡
maxmemory-samples 10
</code></pre>
<h3><a class="header" href="#é€šè¿‡å‘½ä»¤è¿è¡Œæ—¶ä¿®æ”¹" id="é€šè¿‡å‘½ä»¤è¿è¡Œæ—¶ä¿®æ”¹">é€šè¿‡å‘½ä»¤è¿è¡Œæ—¶ä¿®æ”¹</a></h3>
<p>Redisæ”¯æŒè¿è¡Œæ—¶é€šè¿‡å‘½ä»¤åŠ¨æ€ä¿®æ”¹å†…å­˜å¤§å°</p>
<p>æœä¸è®¾ç½®æœ€å¤§å†…å­˜å¤§å°æˆ–è€…è®¾ç½®æœ€å¤§å†…å­˜å¤§å°ä¸º0ï¼Œåœ¨64ä½æ“ä½œç³»ç»Ÿä¸‹ä¸é™åˆ¶å†…å­˜å¤§å°</p>
<pre><code>//è®¾ç½®Redisæœ€å¤§å ç”¨å†…å­˜å¤§å°ä¸º100M
127.0.0.1:6379&gt; config set maxmemory 100mb
//è·å–è®¾ç½®çš„Redisèƒ½ä½¿ç”¨çš„æœ€å¤§å†…å­˜å¤§å°
127.0.0.1:6379&gt; config get maxmemory

config get maxmemory-policy
config set maxmemory-policy allkeys-lru
</code></pre>
<h1><a class="header" href="#æŒä¹…åŒ–" id="æŒä¹…åŒ–">æŒä¹…åŒ–</a></h1>
<h2><a class="header" href="#å¤‡ä»½é€‰å‹" id="å¤‡ä»½é€‰å‹">å¤‡ä»½é€‰å‹</a></h2>
<p>Redis çš„æŒä¹…åŒ–æœºåˆ¶æœ‰ä¸¤ç§ï¼Œç¬¬ä¸€ç§æ˜¯å¿«ç…§ï¼ˆRDBï¼‰ï¼Œç¬¬äºŒç§æ˜¯ AOF æ—¥å¿—ã€‚</p>
<p>å¿«ç…§æ˜¯ä¸€æ¬¡å…¨é‡å¤‡ä»½ï¼ŒAOF æ—¥å¿—æ˜¯è¿ç»­çš„å¢é‡å¤‡ä»½ã€‚å¿«ç…§æ˜¯å†…å­˜æ•°æ®çš„äºŒè¿›åˆ¶åºåˆ—åŒ–å½¢å¼ï¼Œåœ¨å­˜å‚¨ä¸Šéå¸¸ç´§å‡‘ï¼Œè€Œ AOF æ—¥å¿—è®°å½•çš„æ˜¯æ•°æ®ä¿®æ”¹çš„æŒ‡ä»¤æ–‡æœ¬, æœ‰å†—ä½™ã€‚</p>
<p>RDBæ˜¯é€šè¿‡Redisä¸»è¿›ç¨‹forkå­è¿›ç¨‹ï¼Œè®©å­è¿›ç¨‹æ‰§è¡Œç£ç›˜ IO æ“ä½œæ¥è¿›è¡Œ RDB æŒä¹…åŒ–ï¼ŒAOF æ—¥å¿—å­˜å‚¨çš„æ˜¯ Redis æœåŠ¡å™¨çš„é¡ºåºæŒ‡ä»¤åºåˆ—ï¼ŒAOF æ—¥å¿—åªè®°å½•å¯¹å†…å­˜è¿›è¡Œä¿®æ”¹çš„æŒ‡ä»¤è®°å½•ã€‚å³RDBè®°å½•çš„æ˜¯æ•°æ®ï¼ŒAOFè®°å½•çš„æ˜¯æŒ‡ä»¤</p>
<p>ä¸è¦ä»…ä»…ä½¿ç”¨ RDBï¼Œå› ä¸ºé‚£æ ·ä¼šå¯¼è‡´ä½ ä¸¢å¤±å¾ˆå¤šæ•°æ®ï¼Œå› ä¸ºRDBæ˜¯éš”ä¸€æ®µæ—¶é—´æ¥å¤‡ä»½æ•°æ®</p>
<p>ä¹Ÿä¸è¦ä»…ä»…ä½¿ç”¨ AOFï¼Œå› ä¸ºé‚£æ ·æœ‰ä¸¤ä¸ªé—®é¢˜ï¼Œç¬¬ä¸€ï¼Œé€Ÿåº¦æ…¢; ç¬¬äºŒï¼Œaofæ—¥å¿—æ–‡ä»¶å‡ºbug çš„å‡ ç‡å¤§äº rdbå¿«ç…§çš„äºŒè¿›åˆ¶æ–‡ä»¶</p>
<p>ç”¨RDBæ¢å¤å†…å­˜çŠ¶æ€ä¼šä¸¢å¤±å¾ˆå¤šæ•°æ®ï¼Œé‡æ”¾AOPæ—¥å¿—åˆå¾ˆæ…¢ã€‚Redis4.0æ¨å‡ºäº†æ··åˆæŒä¹…åŒ–æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å°† rdb æ–‡ä»¶çš„å†…å®¹å’Œå¢é‡çš„ AOF æ—¥å¿—æ–‡ä»¶å­˜åœ¨ä¸€èµ·ã€‚è¿™é‡Œçš„ AOF æ—¥å¿—ä¸å†æ˜¯å…¨é‡çš„æ—¥å¿—ï¼Œè€Œæ˜¯è‡ªæŒä¹…åŒ–å¼€å§‹åˆ°æŒä¹…åŒ–ç»“æŸçš„è¿™æ®µæ—¶é—´å‘ç”Ÿçš„å¢é‡ AOF æ—¥å¿—ï¼Œé€šå¸¸è¿™éƒ¨åˆ† AOF æ—¥å¿—å¾ˆå°ã€‚äºæ˜¯åœ¨ Redis é‡å¯çš„æ—¶å€™ï¼Œå¯ä»¥å…ˆåŠ è½½ rdb çš„å†…å®¹ï¼Œç„¶åå†é‡æ”¾å¢é‡ AOF æ—¥å¿—å°±å¯ä»¥å®Œå…¨æ›¿ä»£ä¹‹å‰çš„ AOF å…¨é‡æ–‡ä»¶é‡æ”¾</p>
<h2><a class="header" href="#rdb-å¿«ç…§æŒä¹…åŒ–" id="rdb-å¿«ç…§æŒä¹…åŒ–">RDB-å¿«ç…§æŒä¹…åŒ–</a></h2>
<h3><a class="header" href="#rdbæŒä¹…åŒ–æ¦‚å¿µ" id="rdbæŒä¹…åŒ–æ¦‚å¿µ">RDBæŒä¹…åŒ–æ¦‚å¿µ</a></h3>
<p>å†™æ“ä½œåˆ°è¾¾ä¸€å®šå¯†åº¦, è§¦å‘å¿«ç…§, é¢‘ç‡å¯é…ç½®</p>
<p>ä¼˜:</p>
<ul>
<li>
<p>rdbæ–‡ä»¶æ˜¯ç»è¿‡å‹ç¼©çš„äºŒè¿›åˆ¶æ–‡ä»¶, ä½“ç§¯å°</p>
</li>
<li>
<p>redisåŠ è½½ rdbæ–‡ä»¶é€Ÿåº¦å¿«äº aof çš„æ–¹å¼</p>
</li>
</ul>
<p>ç¼ºç‚¹:</p>
<ul>
<li>
<p>rdb æŒä¹…åŒ–æ— æ³•åšåˆ°å®æ—¶æŒä¹…åŒ–</p>
<p>åˆ©ç”¨å¿«ç…§è¿›è¡Œå¤‡ä»½ã€‚å¦‚æœç³»ç»Ÿå‘ç”Ÿæ•…éšœï¼Œå°†ä¼šä¸¢å¤±æœ€åä¸€æ¬¡åˆ›å»ºå¿«ç…§ä¹‹åçš„æ•°æ®</p>
</li>
<li>
<p>rdb æ–‡ä»¶æ ¼å¼åœ¨ä¸åŒç‰ˆæœ¬redisä¸­æœ‰ä¸åŒ, å…¼å®¹æ€§ä¸å¥½</p>
</li>
</ul>
<h3><a class="header" href="#è§¦å‘æœºåˆ¶-å¦‚ä½•å¼€å¯" id="è§¦å‘æœºåˆ¶-å¦‚ä½•å¼€å¯">è§¦å‘æœºåˆ¶-å¦‚ä½•å¼€å¯</a></h3>
<p>è‡ªåŠ¨è§¦å‘, æ‰‹åŠ¨è§¦å‘</p>
<p>å¯¹äºæ‰‹åŠ¨è§¦å‘: <code>save</code> é˜»å¡ redis ç›´åˆ° rdb è¿‡ç¨‹å®Œæˆ, ä¸€èˆ¬ä¸ç”¨;  <code>bgsave</code> ä½¿å¾—redisè¿›ç¨‹åˆ›å»ºæ–°çš„è¿›ç¨‹æ‰§è¡Œ rdbè¿‡ç¨‹, åŸºæœ¬æ²¡æœ‰é˜»å¡</p>
<p>å¯¹äºè‡ªåŠ¨è§¦å‘: ğŸ“Œ <code>save m n</code> åœ¨ m ç§’å†…, æ•°æ®é›†æœ‰äº† n æ¬¡ä¿®æ”¹, è‡ªåŠ¨è§¦å‘ bgsave; ğŸ“Œ <code>debug reload</code> é‡æ–°åŠ è½½ redis; ğŸ“Œ <code>shutdown</code></p>
<p>bgsave æµç¨‹ç¤ºæ„å›¾:</p>
<p><img src="Snipaste_2018-12-10_18-31-17.png" alt="alt" /></p>
<h3><a class="header" href="#rdbæ–‡ä»¶" id="rdbæ–‡ä»¶">RDBæ–‡ä»¶</a></h3>
<p>rdbæ–‡ä»¶å­˜å‚¨åœ¨ dir é…ç½®æŒ‡å®šçš„ç›®å½•ä¸‹,æ–‡ä»¶åé€šè¿‡ dbfilename é…ç½®æŒ‡å®š</p>
<h2><a class="header" href="#aof-æ—¥å¿—æŒä¹…åŒ–" id="aof-æ—¥å¿—æŒä¹…åŒ–">AOF-æ—¥å¿—æŒä¹…åŒ–</a></h2>
<h3><a class="header" href="#aofæ¦‚å¿µ" id="aofæ¦‚å¿µ">aofæ¦‚å¿µ</a></h3>
<p>redisçš„æ¯ä¸ªå†™æ“ä½œéƒ½ä¼šè¢«è¿½åŠ åˆ°ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ä¸­</p>
<p>å°†å†™å‘½ä»¤æ·»åŠ åˆ° AOF æ–‡ä»¶ï¼ˆAppend Only Fileï¼‰çš„æœ«å°¾ã€‚ --------- ä»¥ç‹¬ç«‹æ—¥å¿—æ–‡ä»¶çš„æ–¹å¼è®°å½•æ¯æ¬¡å†™å‘½ä»¤, è§£å†³äº† RDBæ–¹å¼ä¸èƒ½å®æ—¶æŒä¹…åŒ–çš„é—®é¢˜</p>
<p>rdb, aofåŒæ—¶å­˜åœ¨æ—¶, redisé‡å¯æ—¶ä¼˜å…ˆè½½å…¥ aof æ–‡ä»¶æ¥æ¢å¤æ•°æ® (aof æ¯” rdb è®°å½•çš„æ•°æ®æ›´å…¨)</p>
<p>é€šè¿‡ <code>appendonly yes</code> é…ç½® å¼€å¯ aof, aofæ–‡ä»¶åé€šè¿‡ appendfilename é…ç½®è®¾ç½®, é»˜è®¤ä¸º appendonly.aof, ä¿å­˜è·¯å¾„åŒrdbä¸­çš„diré…ç½®</p>
<p>ç¼–è¾‘ /etc/redis/redis.conf, </p>
<pre><code class="language-sh">appendonly yes
</code></pre>
<h3><a class="header" href="#å†™å…¥åŸç†" id="å†™å…¥åŸç†">å†™å…¥åŸç†</a></h3>
<p>ä»¥<code>æ–‡æœ¬æ–¹å¼</code>å†™å…¥<code>aofç¼“å­˜åŒº</code> , ç„¶åç”±æ“ä½œç³»ç»Ÿå†³å®šä»€ä¹ˆæ—¶å€™å°†è¯¥å†…å®¹åŒæ­¥åˆ°ç¡¬ç›˜ï¼Œç”¨æˆ·å¯ä»¥è°ƒç”¨ file.flush() æ–¹æ³•è¯·æ±‚æ“ä½œç³»ç»Ÿå°½å¿«å°†ç¼“å†²åŒºå­˜å‚¨çš„æ•°æ®åŒæ­¥åˆ°ç¡¬ç›˜ã€‚å¯ä»¥çœ‹å‡º<code>å†™å…¥æ–‡ä»¶çš„æ•°æ®ä¸ä¼šç«‹å³åŒæ­¥åˆ°ç¡¬ç›˜</code>ä¸Šï¼Œåœ¨å°†å†™å‘½ä»¤æ·»åŠ åˆ° AOF æ–‡ä»¶æ—¶ï¼Œè¦æ ¹æ®éœ€æ±‚æ¥ä¿è¯ä½•æ—¶åŒæ­¥åˆ°ç¡¬ç›˜ä¸Šã€‚</p>
<ul>
<li>
<p>ä¸ºä»€ä¹ˆä½¿ç”¨æ–‡æœ¬æ ¼å¼? ğŸ“Œ æ–‡æœ¬æ ¼å¼å…·æœ‰å¾ˆå¥½çš„å…¼å®¹æ€§; ğŸ“Œ æ–‡æœ¬æ ¼å¼å¾ˆå®¹æ˜“å¤„ç†è¿½åŠ æ“ä½œ; ğŸ“Œ å¯è¯»æ€§, ç›´æ¥ä¿®æ”¹å¤„ç†;</p>
</li>
<li>
<p>ä¸ºä»€ä¹ˆå‘½ä»¤å†™å…¥éœ€è¦å…ˆåŠ å…¥&quot;aofç¼“å­˜åŒº&quot;? ğŸ“Œ redisæ˜¯å•çº¿ç¨‹æ‰§è¡Œå‘½ä»¤, å¦‚æœä¸ä½¿ç”¨&quot;ç¼“å­˜åŒº&quot;, è€Œæ˜¯ç›´æ¥å†™å…¥åˆ°ç¡¬ç›˜, åˆ™ç¡¬ç›˜è¯»å†™é€Ÿåº¦ä¼šæˆä¸ºç“¶é¢ˆ; ğŸ“Œ redis å¯ä½¿ç”¨å¤šç§ä¸é€šè¿‡çš„ ç¼“å­˜åŒº-ç¡¬ç›˜ åŒæ­¥ç­–ç•¥, åœ¨æ€§èƒ½å’Œå®‰å…¨ä¸­åšå‡ºå¹³è¡¡.</p>
</li>
</ul>
<h3><a class="header" href="#æ–‡ä»¶åŒæ­¥" id="æ–‡ä»¶åŒæ­¥">æ–‡ä»¶åŒæ­¥</a></h3>
<p>æœ‰ä¸‰ä¸ªåŒæ­¥é€‰é¡¹:</p>
<ul>
<li>always æ¯ä¸ªå†™å‘½ä»¤éƒ½åŒæ­¥ (always é€‰é¡¹ä¼šä¸¥é‡å‡ä½æœåŠ¡å™¨çš„æ€§èƒ½)</li>
<li>everysec æ¯ç§’åŒæ­¥ä¸€æ¬¡ (everysec é€‰é¡¹æ¯”è¾ƒåˆé€‚ï¼Œå¯ä»¥ä¿è¯ç³»ç»Ÿå¥”æºƒæ—¶åªä¼šä¸¢å¤±ä¸€ç§’å·¦å³çš„æ•°æ®ï¼Œå¹¶ä¸” Redis æ¯ç§’æ‰§è¡Œä¸€æ¬¡åŒæ­¥å¯¹æœåŠ¡å™¨æ€§èƒ½å‡ ä¹æ²¡æœ‰ä»»ä½•å½±å“)</li>
<li>no è®©æ“ä½œç³»ç»Ÿæ¥å†³å®šä½•æ—¶åŒæ­¥ (no é€‰é¡¹å¹¶ä¸èƒ½ç»™æœåŠ¡å™¨æ€§èƒ½å¸¦æ¥å¤šå¤§çš„æå‡ï¼Œè€Œä¸”ä¹Ÿä¼šå¢åŠ ç³»ç»Ÿå¥”æºƒæ—¶æ•°æ®ä¸¢å¤±çš„æ•°é‡)</li>
</ul>
<h3><a class="header" href="#é‡å†™æœºåˆ¶" id="é‡å†™æœºåˆ¶">é‡å†™æœºåˆ¶</a></h3>
<p>éšç€æœåŠ¡å™¨å†™è¯·æ±‚çš„å¢å¤šï¼ŒAOF æ–‡ä»¶ä¼šè¶Šæ¥è¶Šå¤§ã€‚Redis æä¾›äº†ä¸€ç§å°† AOF é‡å†™çš„ç‰¹æ€§ï¼Œèƒ½å¤Ÿå»é™¤ AOF æ–‡ä»¶ä¸­çš„å†—ä½™å†™å‘½ä»¤ã€‚å‹ç¼©æ–‡ä»¶ä½“ç§¯.</p>
<p>é‡å†™çš„æ„ä¹‰:</p>
<ul>
<li>è¿›ç¨‹å†…è¶…æ—¶å‘½ä»¤ä¸ä¼šå†å†™å…¥</li>
<li>æ— æ•ˆå‘½ä»¤ä¸å†å†™å…¥, åªå†™å…¥ç”Ÿæˆæœ€ç»ˆæ•°æ®çš„å‘½ä»¤</li>
<li>å¤šæ¡å†™å‘½ä»¤å¯ä»¥åˆå¹¶</li>
</ul>
<p>å¦‚ä½•è§¦å‘é‡å†™:</p>
<ul>
<li>æ‰‹åŠ¨è§¦å‘: <code>bgrewriteaof</code></li>
<li>è‡ªåŠ¨è§¦å‘: </li>
</ul>
<h3><a class="header" href="#aof-æŸå" id="aof-æŸå">aof æŸå</a></h3>
<p>åŠ è½½æŸåçš„aof æ–‡ä»¶ä¼šå¯åŠ¨å¤±è´¥; è¿™æ˜¯å¯ä»¥å…ˆå¤‡ä»½è¿™ä¸ªæ–‡ä»¶ç„¶åå°è¯•é€šè¿‡ <code>redis-check-aof-fix</code> ä¿®å¤</p>
<h1><a class="header" href="#å‘å¸ƒä¸è®¢é˜…" id="å‘å¸ƒä¸è®¢é˜…">å‘å¸ƒä¸è®¢é˜…</a></h1>
<p>è®¢é˜…è€…è®¢é˜…äº†é¢‘é“ä¹‹åï¼Œå‘å¸ƒè€…å‘é¢‘é“å‘é€å­—ç¬¦ä¸²æ¶ˆæ¯ä¼šè¢«æ‰€æœ‰è®¢é˜…è€…æ¥æ”¶åˆ° (æŸä¸ªå®¢æˆ·ç«¯ä½¿ç”¨ SUBSCRIBE è®¢é˜…ä¸€ä¸ªé¢‘é“ï¼Œå…¶å®ƒå®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨ PUBLISH å‘è¿™ä¸ªé¢‘é“å‘é€æ¶ˆæ¯ã€‚)</p>
<p>å‘å¸ƒä¸è®¢é˜…æ¨¡å¼å’Œè§‚å¯Ÿè€…æ¨¡å¼æœ‰ä»¥ä¸‹ä¸åŒ:</p>
<ul>
<li>
<p>è§‚å¯Ÿè€…æ¨¡å¼ä¸­ï¼Œè§‚å¯Ÿè€…å’Œä¸»é¢˜éƒ½çŸ¥é“å¯¹æ–¹çš„å­˜åœ¨ï¼›è€Œåœ¨å‘å¸ƒä¸è®¢é˜…æ¨¡å¼ä¸­ï¼Œå‘å¸ƒè€…ä¸è®¢é˜…è€…ä¸çŸ¥é“å¯¹æ–¹çš„å­˜åœ¨ï¼Œå®ƒä»¬ä¹‹é—´é€šè¿‡é¢‘é“è¿›è¡Œé€šä¿¡ã€‚</p>
</li>
<li>
<p>è§‚å¯Ÿè€…æ¨¡å¼æ˜¯åŒæ­¥çš„ï¼Œå½“äº‹ä»¶è§¦å‘æ—¶ï¼Œä¸»é¢˜ä¼šå»è°ƒç”¨è§‚å¯Ÿè€…çš„æ–¹æ³•ï¼Œç„¶åç­‰å¾…æ–¹æ³•è¿”å›ï¼›è€Œå‘å¸ƒä¸è®¢é˜…æ¨¡å¼æ˜¯å¼‚æ­¥çš„ï¼Œå‘å¸ƒè€…å‘é¢‘é“å‘é€ä¸€ä¸ªæ¶ˆæ¯ä¹‹åï¼Œå°±ä¸éœ€è¦å…³å¿ƒè®¢é˜…è€…ä½•æ—¶å»è®¢é˜…è¿™ä¸ªæ¶ˆæ¯ã€‚</p>
<p><img src="Snipaste_2018-07-20_12-21-29.png" alt="alt" /></p>
</li>
</ul>
<h1><a class="header" href="#äº‹åŠ¡" id="äº‹åŠ¡">äº‹åŠ¡</a></h1>
<p>Redis æœ€ç®€å•çš„äº‹åŠ¡å®ç°æ–¹å¼æ˜¯ä½¿ç”¨ MULTI å’Œ EXEC å‘½ä»¤å°†äº‹åŠ¡æ“ä½œåŒ…å›´èµ·æ¥ã€‚</p>
<p>redisäº‹åŠ¡åœ¨æ‰§è¡Œçš„ä¸­é€”é‡åˆ°é”™è¯¯ï¼Œä¸ä¼šå›æ»šè€Œæ˜¯ç»§ç»­æ‰§è¡Œåç»­å‘½ä»¤ï¼›ï¼ˆè¿ååŸå­æ€§ï¼‰ .é‚£ä¹ˆredisä¸ºä»€ä¹ˆè¿˜è¦äº‹åŠ¡å‘¢? - äº‹åŠ¡ä¸­çš„å¤šä¸ªå‘½ä»¤è¢«ä¸€æ¬¡æ€§å‘é€ç»™æœåŠ¡å™¨ï¼Œè€Œä¸æ˜¯ä¸€æ¡ä¸€æ¡å‘é€ï¼Œè¿™ç§æ–¹å¼è¢«ç§°ä¸ºæµæ°´çº¿ï¼Œå®ƒå¯ä»¥å‡å°‘å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„ç½‘ç»œé€šä¿¡æ¬¡æ•°ä»è€Œæå‡æ€§èƒ½ã€‚</p>
<p>redisäº‹åŠ¡ä¸­çš„å‘½ä»¤åœ¨æ‰§è¡Œexecå‘½ä»¤å‰ä¼šè¢«æ”¾å…¥é˜Ÿåˆ—, å¹¶ä¸ä¼šå®é™…æ‰§è¡Œ, ä¹Ÿå°±ä¸å­˜åœ¨éš”ç¦»çº§åˆ«çš„æ¦‚å¿µ</p>
<p>watch key1 key2... : ç±»ä¼¼äºä¹è§‚é”, å¦‚æœæŸä¸ªäº‹åŠ¡æäº¤æ—¶, æœ‰å…¶ä»–client æ”¹å˜äº†ä»»æ„ä¸€ä¸ª key, åˆ™ä½¿ç”¨ exec æ‰§è¡Œäº‹åŠ¡æ—¶, äº‹åŠ¡é˜Ÿåˆ—ä¸ä¼šè¢«æ‰§è¡Œ;</p>
<h1><a class="header" href="#äº‹ä»¶" id="äº‹ä»¶">äº‹ä»¶</a></h1>
<p>Redis æœåŠ¡å™¨æ˜¯ä¸€ä¸ªäº‹ä»¶é©±åŠ¨ç¨‹åºã€‚</p>
<h2><a class="header" href="#æ–‡ä»¶äº‹ä»¶" id="æ–‡ä»¶äº‹ä»¶">æ–‡ä»¶äº‹ä»¶</a></h2>
<p>æœåŠ¡å™¨é€šè¿‡å¥—æ¥å­—ä¸å®¢æˆ·ç«¯æˆ–è€…å…¶å®ƒæœåŠ¡å™¨è¿›è¡Œé€šä¿¡ï¼Œæ–‡ä»¶äº‹ä»¶å°±æ˜¯å¯¹å¥—æ¥å­—æ“ä½œçš„æŠ½è±¡ã€‚</p>
<p>Redis åŸºäº Reactor æ¨¡å¼å¼€å‘äº†è‡ªå·±çš„ç½‘ç»œäº‹ä»¶å¤„ç†å™¨ï¼Œä½¿ç”¨ I/O å¤šè·¯å¤ç”¨ç¨‹åºæ¥åŒæ—¶ç›‘å¬å¤šä¸ªå¥—æ¥å­—ï¼Œå¹¶å°†åˆ°è¾¾çš„äº‹ä»¶ä¼ é€ç»™æ–‡ä»¶äº‹ä»¶åˆ†æ´¾å™¨ï¼Œåˆ†æ´¾å™¨ä¼šæ ¹æ®å¥—æ¥å­—äº§ç”Ÿçš„äº‹ä»¶ç±»å‹è°ƒç”¨ç›¸åº”çš„äº‹ä»¶å¤„ç†å™¨ã€‚</p>
<p><img src="Snipaste_2018-07-20_12-25-16.png" alt="alt" /></p>
<h2><a class="header" href="#æ—¶é—´äº‹ä»¶" id="æ—¶é—´äº‹ä»¶">æ—¶é—´äº‹ä»¶</a></h2>
<p>æœåŠ¡å™¨æœ‰ä¸€äº›æ“ä½œéœ€è¦åœ¨ç»™å®šçš„æ—¶é—´ç‚¹æ‰§è¡Œï¼Œæ—¶é—´äº‹ä»¶æ˜¯å¯¹è¿™ç±»å®šæ—¶æ“ä½œçš„æŠ½è±¡ã€‚</p>
<p>æ—¶é—´äº‹ä»¶åˆåˆ†ä¸ºï¼šå®šæ—¶äº‹ä»¶, å‘¨æœŸäº‹ä»¶</p>
<p>Redis å°†æ‰€æœ‰æ—¶é—´äº‹ä»¶éƒ½æ”¾åœ¨ä¸€ä¸ªæ— åºé“¾è¡¨ä¸­ï¼Œé€šè¿‡éå†æ•´ä¸ªé“¾è¡¨æŸ¥æ‰¾å‡ºå·²åˆ°è¾¾çš„æ—¶é—´äº‹ä»¶ï¼Œå¹¶è°ƒç”¨ç›¸åº”çš„äº‹ä»¶å¤„ç†å™¨ã€‚</p>
<h2><a class="header" href="#äº‹ä»¶çš„è°ƒåº¦æ‰§è¡Œ" id="äº‹ä»¶çš„è°ƒåº¦æ‰§è¡Œ">äº‹ä»¶çš„è°ƒåº¦&amp;æ‰§è¡Œ</a></h2>
<h1><a class="header" href="#redisé›†ç¾¤" id="redisé›†ç¾¤">redisé›†ç¾¤</a></h1>
<p>é€šè¿‡ä½¿ç”¨ slaveof host port å‘½ä»¤æ¥è®©ä¸€ä¸ªæœåŠ¡å™¨æˆä¸ºå¦ä¸€ä¸ªæœåŠ¡å™¨çš„ä»æœåŠ¡å™¨ã€‚</p>
<p>ä¸€ä¸ªä»æœåŠ¡å™¨åªèƒ½æœ‰ä¸€ä¸ªä¸»æœåŠ¡å™¨ï¼Œå¹¶ä¸”ä¸æ”¯æŒä¸»ä¸»å¤åˆ¶ã€‚</p>
<h2><a class="header" href="#è¿æ¥è¿‡ç¨‹" id="è¿æ¥è¿‡ç¨‹">è¿æ¥è¿‡ç¨‹</a></h2>
<ol>
<li>
<p>ä¸»æœåŠ¡å™¨åˆ›å»ºå¿«ç…§æ–‡ä»¶ï¼Œå‘é€ç»™ä»æœåŠ¡å™¨ï¼Œå¹¶åœ¨å‘é€æœŸé—´ä½¿ç”¨ç¼“å†²åŒºè®°å½•æ‰§è¡Œçš„å†™å‘½ä»¤ã€‚å¿«ç…§æ–‡ä»¶å‘é€å®Œæ¯•ä¹‹åï¼Œå¼€å§‹å‘ä»æœåŠ¡å™¨å‘é€å­˜å‚¨åœ¨ç¼“å†²åŒºä¸­çš„å†™å‘½ä»¤ï¼›</p>
</li>
<li>
<p>ä»æœåŠ¡å™¨ä¸¢å¼ƒæ‰€æœ‰æ—§æ•°æ®ï¼Œè½½å…¥ä¸»æœåŠ¡å™¨å‘æ¥çš„å¿«ç…§æ–‡ä»¶ï¼Œä¹‹åä»æœåŠ¡å™¨å¼€å§‹æ¥å—ä¸»æœåŠ¡å™¨å‘æ¥çš„å†™å‘½ä»¤ï¼›</p>
</li>
<li>
<p>ä¸»æœåŠ¡å™¨æ¯æ‰§è¡Œä¸€æ¬¡å†™å‘½ä»¤ï¼Œå°±å‘ä»æœåŠ¡å™¨å‘é€ç›¸åŒçš„å†™å‘½ä»¤ã€‚</p>
</li>
</ol>
<h2><a class="header" href="#ä¸»ä»é“¾" id="ä¸»ä»é“¾">ä¸»ä»é“¾</a></h2>
<p>éšç€è´Ÿè½½ä¸æ–­ä¸Šå‡ï¼Œä¸»æœåŠ¡å™¨å¯èƒ½æ— æ³•å¾ˆå¿«åœ°æ›´æ–°æ‰€æœ‰ä»æœåŠ¡å™¨ï¼Œæˆ–è€…é‡æ–°è¿æ¥å’Œé‡æ–°åŒæ­¥ä»æœåŠ¡å™¨å°†å¯¼è‡´ç³»ç»Ÿè¶…è½½ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªä¸­é—´å±‚æ¥åˆ†æ‹…ä¸»æœåŠ¡å™¨çš„å¤åˆ¶å·¥ä½œã€‚ä¸­é—´å±‚çš„æœåŠ¡å™¨æ˜¯æœ€ä¸Šå±‚æœåŠ¡å™¨çš„ä»æœåŠ¡å™¨ï¼Œåˆæ˜¯æœ€ä¸‹å±‚æœåŠ¡å™¨çš„ä¸»æœåŠ¡å™¨ã€‚</p>
<p><img src="Snipaste_2018-07-20_12-29-01.png" alt="alt" /></p>
<h1><a class="header" href="#å“¨å…µ-sentinel" id="å“¨å…µ-sentinel">å“¨å…µ Sentinel</a></h1>
<p>ä¸‹çº¿æ¨ä¸¾</p>
<p>Sentinelï¼ˆå“¨å…µï¼‰å¯ä»¥ç›‘å¬ä¸»æœåŠ¡å™¨ï¼Œå¹¶åœ¨ä¸»æœåŠ¡å™¨è¿›å…¥ä¸‹çº¿çŠ¶æ€æ—¶ï¼Œè‡ªåŠ¨ä»ä»æœåŠ¡å™¨ä¸­é€‰ä¸¾å‡ºæ–°çš„ä¸»æœåŠ¡å™¨ã€‚</p>
<h1><a class="header" href="#åˆ†ç‰‡" id="åˆ†ç‰‡">åˆ†ç‰‡</a></h1>
<p>åˆ†ç‰‡æ˜¯å°†æ•°æ®åˆ’åˆ†ä¸ºå¤šä¸ªéƒ¨åˆ†çš„æ–¹æ³•ï¼Œå¯ä»¥å°†æ•°æ®å­˜å‚¨åˆ°å¤šå°æœºå™¨é‡Œé¢ï¼Œä¹Ÿå¯ä»¥ä»å¤šå°æœºå™¨é‡Œé¢è·å–æ•°æ®ï¼Œ</p>
<blockquote>
<p>å‡è®¾æœ‰ 4 ä¸ª Reids å®ä¾‹ R0ï¼ŒR1ï¼ŒR2ï¼ŒR3ï¼Œè¿˜æœ‰å¾ˆå¤šè¡¨ç¤ºç”¨æˆ·çš„é”® user:1ï¼Œuser:2ï¼Œ... ç­‰ç­‰ï¼Œæœ‰ä¸åŒçš„æ–¹å¼æ¥é€‰æ‹©ä¸€ä¸ªæŒ‡å®šçš„é”®å­˜å‚¨åœ¨å“ªä¸ªå®ä¾‹ä¸­ã€‚æœ€ç®€å•çš„æ–¹å¼æ˜¯èŒƒå›´åˆ†ç‰‡ï¼Œä¾‹å¦‚ç”¨æˆ· id ä» 0~1000 çš„å­˜å‚¨åˆ°å®ä¾‹ R0 ä¸­ï¼Œç”¨æˆ· id ä» 1001~2000 çš„å­˜å‚¨åˆ°å®ä¾‹ R1 ä¸­ï¼Œç­‰ç­‰ã€‚ä½†æ˜¯è¿™æ ·éœ€è¦ç»´æŠ¤ä¸€å¼ æ˜ å°„èŒƒå›´è¡¨ï¼Œç»´æŠ¤æ“ä½œä»£ä»·å¾ˆé«˜ã€‚è¿˜æœ‰ä¸€ç§æ–¹å¼æ˜¯å“ˆå¸Œåˆ†ç‰‡ï¼Œä½¿ç”¨ CRC32 å“ˆå¸Œå‡½æ•°å°†é”®è½¬æ¢ä¸ºä¸€ä¸ªæ•°å­—ï¼Œå†å¯¹å®ä¾‹æ•°é‡æ±‚æ¨¡å°±èƒ½çŸ¥é“åº”è¯¥å­˜å‚¨çš„å®ä¾‹ã€‚</p>
</blockquote>
<p>æ ¹æ®æ‰§è¡Œåˆ†ç‰‡çš„ä½ç½®ï¼Œå¯ä»¥åˆ†ä¸ºä¸‰ç§åˆ†ç‰‡æ–¹å¼ï¼š</p>
<ul>
<li>å®¢æˆ·ç«¯åˆ†ç‰‡ï¼šå®¢æˆ·ç«¯ä½¿ç”¨ <a href="#%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C">#ä¸€è‡´æ€§å“ˆå¸Œ</a> ç­‰ç®—æ³•å†³å®šé”®åº”å½“åˆ†å¸ƒåˆ°å“ªä¸ªèŠ‚ç‚¹ã€‚</li>
<li>ä»£ç†åˆ†ç‰‡ï¼šå°†å®¢æˆ·ç«¯è¯·æ±‚å‘é€åˆ°ä»£ç†ä¸Šï¼Œç”±ä»£ç†è½¬å‘è¯·æ±‚åˆ°æ­£ç¡®çš„èŠ‚ç‚¹ä¸Šã€‚</li>
<li>æœåŠ¡å™¨åˆ†ç‰‡ï¼šRedis Clusterã€‚</li>
</ul>
<h1><a class="header" href="#ä¸€ä¸ªç®€å•çš„è®ºå›ç³»ç»Ÿ" id="ä¸€ä¸ªç®€å•çš„è®ºå›ç³»ç»Ÿ">ä¸€ä¸ªç®€å•çš„è®ºå›ç³»ç»Ÿ</a></h1>
<p>è¯¥è®ºå›ç³»ç»ŸåŠŸèƒ½å¦‚ä¸‹:</p>
<ul>
<li>å¯ä»¥å‘å¸ƒæ–‡ç« ï¼›</li>
<li>å¯ä»¥å¯¹æ–‡ç« è¿›è¡Œç‚¹èµï¼›</li>
<li>åœ¨é¦–é¡µå¯ä»¥æŒ‰æ–‡ç« çš„å‘å¸ƒæ—¶é—´æˆ–è€…æ–‡ç« çš„ç‚¹èµæ•°è¿›è¡Œæ’åºæ˜¾ç¤ºã€‚</li>
</ul>
<h2><a class="header" href="#æ–‡ç« ä¿¡æ¯" id="æ–‡ç« ä¿¡æ¯">æ–‡ç« ä¿¡æ¯</a></h2>
<p>æ–‡ç« åŒ…æ‹¬æ ‡é¢˜ã€ä½œè€…ã€èµæ•°ç­‰ä¿¡æ¯ï¼Œåœ¨å…³ç³»å‹æ•°æ®åº“ä¸­å¾ˆå®¹æ˜“æ„å»ºä¸€å¼ è¡¨æ¥å­˜å‚¨è¿™äº›ä¿¡æ¯ï¼Œåœ¨ Redis ä¸­å¯ä»¥ä½¿ç”¨ HASH æ¥å­˜å‚¨æ¯ç§ä¿¡æ¯ä»¥åŠå…¶å¯¹åº”çš„å€¼çš„æ˜ å°„ã€‚</p>
<p>Redis æ²¡æœ‰å…³ç³»å‹æ•°æ®åº“ä¸­çš„è¡¨è¿™ä¸€æ¦‚å¿µæ¥å°†åŒç§ç±»å‹çš„æ•°æ®å­˜æ”¾åœ¨ä¸€èµ·ï¼Œè€Œæ˜¯ä½¿ç”¨å‘½åç©ºé—´çš„æ–¹å¼æ¥å®ç°è¿™ä¸€åŠŸèƒ½ã€‚é”®åçš„å‰é¢éƒ¨åˆ†å­˜å‚¨å‘½åç©ºé—´ï¼Œåé¢éƒ¨åˆ†çš„å†…å®¹å­˜å‚¨ IDï¼Œé€šå¸¸ä½¿ç”¨ : æ¥è¿›è¡Œåˆ†éš”ã€‚ä¾‹å¦‚ä¸‹é¢çš„ HASH çš„é”®åä¸º article:92617ï¼Œå…¶ä¸­ article ä¸ºå‘½åç©ºé—´ï¼ŒID ä¸º 92617ã€‚</p>
<p><img src="Snipaste_2018-07-20_12-35-52.png" alt="alt" /></p>
<h2><a class="header" href="#ç‚¹èµåŠŸèƒ½" id="ç‚¹èµåŠŸèƒ½">ç‚¹èµåŠŸèƒ½</a></h2>
<p><img src="Snipaste_2018-07-20_12-39-13.png" alt="alt" /></p>
<p>ç‚¹èµã€å–æ¶ˆç‚¹èµæ˜¯é«˜é¢‘æ¬¡çš„æ“ä½œï¼Œè‹¥æ¯æ¬¡éƒ½è¯»å†™æ•°æ®åº“ï¼Œå¤§é‡çš„æ“ä½œä¼šå½±å“æ•°æ®åº“æ€§èƒ½ï¼Œæ‰€ä»¥éœ€è¦åšç¼“å­˜</p>
<p>å®šæ—¶ä» redis ä¸­å–å‡ºç‚¹èµæ•°æ®æŒä¹…åŒ–å­˜å…¥ db, æ¯”å¦‚ 2h</p>
<h2><a class="header" href="#å¯¹æ–‡ç« è¿›è¡Œæ’åº" id="å¯¹æ–‡ç« è¿›è¡Œæ’åº">å¯¹æ–‡ç« è¿›è¡Œæ’åº</a></h2>
<p><img src="Snipaste_2018-07-20_12-39-35.png" alt="alt" /></p>
<h1><a class="header" href="#ä¸€è‡´æ€§å“ˆå¸Œ" id="ä¸€è‡´æ€§å“ˆå¸Œ">ä¸€è‡´æ€§å“ˆå¸Œ</a></h1>
<p>//todo</p>
<h1><a class="header" href="#æ•´åˆ-spring-boot2" id="æ•´åˆ-spring-boot2">æ•´åˆ spring boot2</a></h1>
<h2><a class="header" href="#jedis" id="jedis">jedis</a></h2>
<p>é¡¹ç›®åœ°å€: https://github.com/xetorthio/jedis</p>
<p>Jedis å®ä¾‹æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„, ä¸ºä»€ä¹ˆ?</p>
<ul>
<li>Jedisç±»ä¸­æœ‰RedisInputStreamå’ŒRedisOutputStreamä¸¤ä¸ªå±æ€§ï¼Œè€Œå‘é€å‘½ä»¤å’Œè·å–è¿”å›å€¼éƒ½æ˜¯ä½¿ç”¨è¿™ä¸¤ä¸ªæˆå‘˜å˜é‡ï¼Œæ˜¾ç„¶ï¼Œè¿™å¾ˆå®¹æ˜“å¼•å‘å¤šçº¿ç¨‹é—®é¢˜ã€‚</li>
</ul>
<p>å¯ä»¥é€šè¿‡JedisPoolè¿æ¥æ± å»ç®¡ç†å®ä¾‹ï¼Œåœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹è®©æ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±ç‹¬ç«‹çš„jediså®ä¾‹ æ¥å®ç°çº¿ç¨‹å®‰å…¨</p>
<h2><a class="header" href="#lettuce" id="lettuce">lettuce</a></h2>
<p>https://www.cnblogs.com/throwable/p/11601538.html - ä½¿ç”¨</p>
<p>spring boot2 é»˜è®¤ä½¿ç”¨</p>
<p>Lettuce åŸºäº netty, çº¿ç¨‹å®‰å…¨, å¤§ååé‡, </p>
<p>éœ€è¦æ·»åŠ ä¾èµ– <code>common-pool2</code>, ç”¨äºæä¾›è¿æ¥æ± , <a href="https://blog.csdn.net/qq447995687/article/details/80233621">è‡ªå®šä¹‰å¯¹è±¡è¿æ¥æ± </a> //todo</p>
<pre><code class="language-yml">spring:
  application:
    name: redis-demo
  cache:
    type: redis
    redis:
        # å•ç‹¬ä¸ºä¸åŒçš„ç¼“å­˜å¯ä»¥é…ç½®ä¸åŒçš„è¶…æ—¶æ—¶é—´
      time-to-live: 20000 #é»˜è®¤ç¼“å­˜è¶…æ—¶æ—¶é—´, ms
      cache-null-values: false #æ˜¯å¦ç¼“å­˜ç©ºå€¼
  redis:
    port: 6379
    host: localhost
    lettuce:
      pool:
        max-active: 8
        max-wait: -1
        max-idle: 8
        min-idle: 0
    timeout: 10000  #redis è¿æ¥è¶…æ—¶æ—¶é—´ms
    database: 0
</code></pre>
<p>ä½†æ˜¯æœ‰ä¸ªbug, å¯¼è‡´åœ¨é«˜å¹¶å‘ä¸‹,  netty äº§ç”Ÿå †å¤–å†…å­˜æº¢å‡º OutOfDirectMemoryError; è¿™ä¸ª bug æ˜¯: è‹¥ä¸æŒ‡å®š nettyå †å¤–å†…å­˜ç”¨é‡, é»˜è®¤ä¼šé‡‡ç”¨ -Xmx çš„å€¼, è¿™ä¸ªå€¼æ˜¯ä¸€å®šçš„, ä½†æ˜¯å †å¤–å†…å­˜ä¸ä¼šåŠæ—¶é‡Šæ”¾, æ‰€ä»¥ä¸ç®¡ -Xmx è®¾ç½®å¤šå¤§, æ€»æ˜¯ä¼šç”¨å®Œ, OutOfDirectMemoryError, æ¨è jedis æ›¿ä»£ (https://github.com/seata/seata/issues/2164)</p>
<pre><code class="language-xml">
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;
    &lt;exclusions&gt;
        &lt;exclusion&gt;
            &lt;groupId&gt;io.lettuce&lt;/groupId&gt;
            &lt;artifactId&gt;lettuce-core&lt;/artifactId&gt;
        &lt;/exclusion&gt;
    &lt;/exclusions&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
    &lt;groupId&gt;redis.clients&lt;/groupId&gt;
    &lt;artifactId&gt;jedis&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>
<h2><a class="header" href="#å®šä¹‰åºåˆ—åŒ–å™¨" id="å®šä¹‰åºåˆ—åŒ–å™¨">å®šä¹‰åºåˆ—åŒ–å™¨</a></h2>
<p><a href="https://blog.csdn.net/bai_bug/article/details/81222519">GenericJackson2JsonRedisSerializer Jackson2JsonRedisSerializer åŒºåˆ«</a> - å‰è€…å¯ä»¥ç›´æ¥ä»redis ååºåˆ—åŒ–æˆå¯¹è±¡, ä½†æ˜¯å ç”¨å†…å­˜é«˜ (ä½¿ç”¨GenericJackson2JsonRedisSerializeråºåˆ—åŒ–æ—¶ï¼Œä¼šä¿å­˜åºåˆ—åŒ–çš„å¯¹è±¡çš„åŒ…åå’Œç±»åï¼Œååºåˆ—åŒ–æ—¶ä»¥è¿™ä¸ªä½œä¸ºæ ‡ç¤ºå°±å¯ä»¥ååºåˆ—åŒ–æˆæŒ‡å®šçš„å¯¹è±¡)</p>
<h1><a class="header" href="#é¢è¯•é—®é¢˜" id="é¢è¯•é—®é¢˜">é¢è¯•é—®é¢˜</a></h1>
<p>https://blog.csdn.net/varyall/article/details/81205183 //todo</p>
<h1><a class="header" href="#åˆ†å¸ƒå¼é”" id="åˆ†å¸ƒå¼é”">åˆ†å¸ƒå¼é”</a></h1>
<h2><a class="header" href="#å®ç°åŸç†" id="å®ç°åŸç†">å®ç°åŸç†</a></h2>
<h3><a class="header" href="#åˆ†å¸ƒå¼é”éœ€è¦æ»¡è¶³çš„è¦æ±‚" id="åˆ†å¸ƒå¼é”éœ€è¦æ»¡è¶³çš„è¦æ±‚">åˆ†å¸ƒå¼é”éœ€è¦æ»¡è¶³çš„è¦æ±‚</a></h3>
<ul>
<li>
<p>äº’æ–¥</p>
<p>åŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è·å¾—é”</p>
</li>
<li>
<p>é˜²æ­¢æ­»é” (å³è¦èƒ½å¤Ÿè®¾ç½®é”æœ‰æ•ˆæ—¶é—´)</p>
<p>æ¯”å¦‚æœ‰ä¸ªçº¿ç¨‹è·å¾—é”çš„åŒæ—¶ï¼Œè¿˜æ²¡æœ‰æ¥å¾—åŠå»é‡Šæ”¾é”ï¼Œå°±å› ä¸ºç³»ç»Ÿæ•…éšœæˆ–è€…å…¶å®ƒåŸå› ä½¿å®ƒæ— æ³•æ‰§è¡Œé‡Šæ”¾é”çš„å‘½ä»¤,å¯¼è‡´å…¶å®ƒçº¿ç¨‹éƒ½æ— æ³•è·å¾—é”</p>
</li>
<li>
<p>é”æœ€å¥½æ»¡è¶³å¯é‡å…¥</p>
<p>åŒä¸€ä¸ªçº¿ç¨‹å¯ä»¥é‡å¤æ‹¿åˆ°åŒä¸€ä¸ªèµ„æºçš„é”ã€‚é‡å…¥é”éå¸¸æœ‰åˆ©äºèµ„æºçš„é«˜æ•ˆåˆ©ç”¨</p>
</li>
</ul>
<h3><a class="header" href="#åŠ é”æœºåˆ¶" id="åŠ é”æœºåˆ¶">åŠ é”æœºåˆ¶</a></h3>
<p>çº¿ç¨‹å»è·å–é”ï¼Œè·å–æˆåŠŸ: æ‰§è¡Œluaè„šæœ¬ï¼Œä¿å­˜æ•°æ®åˆ°redisæ•°æ®åº“ã€‚ä¿å­˜æˆåŠŸåˆ™è¡¨ç¤ºè·å–é”æˆåŠŸ</p>
<p>çº¿ç¨‹å»è·å–é”ï¼Œè·å–å¤±è´¥: ä¸€ç›´é€šè¿‡whileå¾ªç¯å°è¯•è·å–é”ï¼Œè·å–æˆåŠŸåï¼Œæ‰§è¡Œluaè„šæœ¬ï¼Œä¿å­˜æ•°æ®åˆ°redisæ•°æ®åº“ã€‚</p>
<p>ä¸ºä»€ä¹ˆä½¿ç”¨ lua:
å¦‚æœä½ çš„ä¸šåŠ¡é€»è¾‘å¤æ‚çš„è¯ï¼Œé€šè¿‡å°è£…åœ¨luaè„šæœ¬ä¸­å‘é€ç»™redisï¼Œè€Œä¸”redisæ˜¯å•çº¿ç¨‹çš„ï¼Œè¿™æ ·å°±ä¿è¯è¿™æ®µå¤æ‚ä¸šåŠ¡é€»è¾‘æ‰§è¡Œçš„åŸå­æ€§</p>
<h3><a class="header" href="#watch-dog-è‡ªåŠ¨å»¶æ—¶æœºåˆ¶" id="watch-dog-è‡ªåŠ¨å»¶æ—¶æœºåˆ¶">watch dog è‡ªåŠ¨å»¶æ—¶æœºåˆ¶</a></h3>
<p>&quot;çœ‹é—¨ç‹—&quot; ç”¨äºè¿™æ ·çš„åœºæ™¯: çº¿ç¨‹1 è·å¾—é”, è¿‡äº†æ®µæ—¶é—´, ä¸šåŠ¡è¿˜æ²¡æœ‰æ‰§è¡Œå®Œï¼Œé”çš„è¿‡æœŸæ—¶é—´å°±åˆ°äº†ï¼Œçº¿ç¨‹1 è¿˜æƒ³æŒæœ‰é”çš„è¯ï¼Œå°±ä¼šå¯åŠ¨ä¸€ä¸ªwatch dogåå°çº¿ç¨‹ï¼Œä¸æ–­çš„å»¶é•¿é”keyçš„ç”Ÿå­˜æ—¶é—´</p>
<p>é»˜è®¤è¿™ä¸ªçœ‹é—¨ç‹—çº¿ç¨‹æ˜¯ä¸å¯åŠ¨çš„ï¼Œè¿˜æœ‰å°±æ˜¯è¿™ä¸ªçœ‹é—¨ç‹—å¯åŠ¨åå¯¹æ•´ä½“æ€§èƒ½ä¹Ÿä¼šæœ‰ä¸€å®šå½±å“ï¼Œæ‰€ä»¥ä¸å»ºè®®å¼€å¯çœ‹é—¨ç‹—ã€‚</p>
<h3><a class="header" href="#redisson-å¦‚ä½•å®ç°å¯é‡å…¥é”" id="redisson-å¦‚ä½•å®ç°å¯é‡å…¥é”">redisson å¦‚ä½•å®ç°å¯é‡å…¥é”</a></h3>
<p>Rediså­˜å‚¨é”çš„æ•°æ®ç±»å‹æ˜¯ Hashç±»å‹, Hashæ•°æ®ç±»å‹çš„ item å€¼åŒ…å«äº†å½“å‰çº¿ç¨‹ä¿¡æ¯</p>
<p><code>key: {item1: value1, item2: value2}</code>, key ä¸ºå›ºå®šå€¼ &quot;redisson&quot;, item æ„æˆä¸º uuid + &quot;:&quot; + current thread id, value1 ä¸º å½“å‰é”è·å–æ¬¡æ•°</p>
<h2><a class="header" href="#redis-å®ç°-åˆ†å¸ƒå¼é”" id="redis-å®ç°-åˆ†å¸ƒå¼é”">redis å®ç° åˆ†å¸ƒå¼é”</a></h2>
<p>è¦æ±‚:</p>
<ul>
<li>set ex 300 nx ... è®¾ç½®è¿‡æœŸæ—¶é—´å’Œå ä½è¦æ˜¯åŸå­æ“ä½œ</li>
<li>æ‰§è¡Œå®Œä¸šåŠ¡è¦åˆ é™¤é”</li>
<li>è¦åˆ é™¤è‡ªå·±çš„é”, è€Œä¸è¦åˆ é™¤åˆ«äººçš„é” (å€¼å­˜ä¸º uuid or thread id)</li>
</ul>
<p>ä¼ªä»£ç </p>
<pre><code class="language-java">Resp withRedisLock() {
    uuid = new uuid().tostring()
    sucess = redis.setNx(&quot;lock&quot;, uuid, 30s)
    try {
        if (success) {
            return biz.exec()
        } else {
            return withRedisLock()// è‡ªæ—‹
        } 
    }
    finally {
        // æŸ¥æ‰¾, åˆ é™¤å¿…é¡»æ˜¯åŸå­æ“ä½œ, ä¸€ä¸‹ä¸ç¬¦åˆ, å¿…é¡»ç”¨ lua è„šæœ¬
        // lockValue = redis.get(&quot;lock&quot;);
        // if (lockValue == uuid) {
        //     redis.delete(&quot;lock&quot;)
        // }

        deleteScript = &quot;if redis.call('get', KEYS[1]) == ARGV[1] then return redis.call('del', KEYS[1]) else return 0 end&quot;
        redis.exec(deleteScript)
    }
    
}

</code></pre>
<h2><a class="header" href="#redisson-å®ç°" id="redisson-å®ç°">redisson å®ç°</a></h2>
<p>redis åˆ†å¸ƒå¼é”çš„å®˜æ–¹æ¨è</p>
<p>watch dog (key è‡ªåŠ¨ç»­æœŸ, é˜²æ­¢ä¸šåŠ¡è¶…æ—¶é”è¢«åˆ é™¤äº†)</p>
<pre><code class="language-xml">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;!-- æ¨èä½¿ç”¨ redisson starter --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.redisson&lt;/groupId&gt;
    &lt;artifactId&gt;redisson&lt;/artifactId&gt;
    &lt;version&gt;3.8.2&lt;/version&gt;
    &lt;optional&gt;true&lt;/optional&gt;
&lt;/dependency&gt;   
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="redis-login-limitation.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="regex-js.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="redis-login-limitation.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="regex-js.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        
        
        
        <script type="text/javascript">
            window.playpen_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
